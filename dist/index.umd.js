(function(R,M){typeof exports=="object"&&typeof module<"u"?M(exports):typeof define=="function"&&define.amd?define(["exports"],M):(R=typeof globalThis<"u"?globalThis:R||self,M(R["rx-nostr"]={}))})(this,function(R){"use strict";var xs=Object.defineProperty;var Ss=(R,M,se)=>M in R?xs(R,M,{enumerable:!0,configurable:!0,writable:!0,value:se}):R[M]=se;var U=(R,M,se)=>(Ss(R,typeof M!="symbol"?M+"":M,se),se);function M(){return Math.floor(new Date().getTime()/1e3)}function se(t){return"length"in t?t.map(fn):[fn(t)]}function fn(t){return{...t,since:t.since?ln(t.since):void 0,until:t.until?ln(t.until):void 0}}function ln(t){return typeof t=="number"?t:t()}const wt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const bt=t=>t instanceof Uint8Array,vt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),te=(t,e)=>t<<32-e|t>>>e;if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");const Pr=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Qe(t){if(!bt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Pr[t[n]];return e}function Cr(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function mt(t){if(typeof t=="string"&&(t=Cr(t)),!bt(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Nr(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!bt(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class hn{clone(){return this._cloneInto()}}function dn(t){const e=r=>t().update(mt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function yn(t=32){if(wt&&typeof wt.getRandomValues=="function")return wt.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Te(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ce(...t){const e=(o,i)=>s=>o(i(s)),n=Array.from(t).reverse().reduce((o,i)=>o?e(o,i.encode):i.encode,void 0),r=t.reduce((o,i)=>o?e(o,i.decode):i.decode,void 0);return{encode:n,decode:r}}function ae(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Te(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function ue(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Xe(t,e="="){if(Te(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function pn(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function gn(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const o=[],i=Array.from(t);for(i.forEach(s=>{if(Te(s),s<0||s>=e)throw new Error(`Wrong integer: ${s}`)});;){let s=0,c=!0;for(let a=r;a<i.length;a++){const u=i[a],f=e*s+u;if(!Number.isSafeInteger(f)||e*s/e!==s||f-u!==e*s)throw new Error("convertRadix: carry overflow");if(s=f%n,i[a]=Math.floor(f/n),!Number.isSafeInteger(i[a])||i[a]*n+s!==f)throw new Error("convertRadix: carry overflow");if(c)i[a]?c=!1:r=a;else continue}if(o.push(s),c)break}for(let s=0;s<t.length-1&&t[s]===0;s++)o.push(0);return o.reverse()}const wn=(t,e)=>e?wn(e,t%e):t,Je=(t,e)=>t+(e-wn(t,e));function Et(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Je(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Je(e,n)}`);let o=0,i=0;const s=2**n-1,c=[];for(const a of t){if(Te(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function Ur(t){return Te(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return gn(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(gn(e,t,2**8))}}}function ye(t,e=!1){if(Te(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Je(8,t)>32||Je(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Et(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Et(n,t,8,e))}}}function bn(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const Lr=ce(ye(4),ae("0123456789ABCDEF"),ue("")),Hr=ce(ye(5),ae("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Xe(5),ue(""));ce(ye(5),ae("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Xe(5),ue("")),ce(ye(5),ae("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ue(""),pn(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const jr=ce(ye(6),ae("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Xe(6),ue("")),zr=ce(ye(6),ae("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Xe(6),ue("")),xt=t=>ce(Ur(58),ae(t),ue("")),St=xt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");xt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),xt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const vn=[0,2,3,5,6,7,9,10,11],Dr={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=St.encode(r).padStart(vn[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),o=vn.indexOf(r.length),i=St.decode(r);for(let s=0;s<i.length-o;s++)if(i[s]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(e)}},At=ce(ae("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ue("")),mn=[996825010,642813549,513874426,1027748829,705979059];function We(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<mn.length;r++)(e>>r&1)===1&&(n^=mn[r]);return n}function En(t,e,n=1){const r=t.length;let o=1;for(let i=0;i<r;i++){const s=t.charCodeAt(i);if(s<33||s>126)throw new Error(`Invalid prefix (${t})`);o=We(o)^s>>5}o=We(o);for(let i=0;i<r;i++)o=We(o)^t.charCodeAt(i)&31;for(let i of e)o=We(o)^i;for(let i=0;i<6;i++)o=We(o);return o^=n,At.encode(Et([o%2**30],30,5,!1))}function xn(t){const e=t==="bech32"?1:734539939,n=ye(5),r=n.decode,o=n.encode,i=bn(r);function s(f,l,y=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const w=f.length+7+l.length;if(y!==!1&&w>y)throw new TypeError(`Length ${w} exceeds limit ${y}`);return f=f.toLowerCase(),`${f}1${At.encode(l)}${En(f,l,e)}`}function c(f,l=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||l!==!1&&f.length>l)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${l})`);const y=f.toLowerCase();if(f!==y&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=y;const w=f.lastIndexOf("1");if(w===0||w===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=f.slice(0,w),h=f.slice(w+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");const p=At.decode(h).slice(0,-6),g=En(d,p,e);if(!h.endsWith(g))throw new Error(`Invalid checksum in ${f}: expected "${g}"`);return{prefix:d,words:p}}const a=bn(c);function u(f){const{prefix:l,words:y}=c(f,!1);return{prefix:l,words:y,bytes:r(y)}}return{encode:s,decode:c,decodeToBytes:u,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:i,toWords:o}}const Sn=xn("bech32");xn("bech32m");const Wr={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},Vr=ce(ye(4),ae("0123456789abcdef"),ue(""),pn(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}));`${Object.keys({utf8:Wr,hex:Vr,base16:Lr,base32:Hr,base64:jr,base64url:zr,base58:St,base58xmr:Dr}).join(", ")}`;function et(t){const{words:e}=Sn.decode(t),n=new Uint8Array(Sn.fromWords(e));return Qe(n)}function It(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Fr(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function An(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Mr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");It(t.outputLen),It(t.blockLen)}function Yr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Kr(t,e){An(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Ae={number:It,bool:Fr,bytes:An,hash:Mr,exists:Yr,output:Kr};function Zr(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+u,c,r)}class Gr extends hn{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=vt(this.buffer)}update(e){Ae.exists(this);const{view:n,buffer:r,blockLen:o}=this;e=mt(e);const i=e.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=vt(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ae.exists(this),Ae.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;Zr(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=vt(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],i)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}}const Qr=(t,e,n)=>t&e^~t&n,Xr=(t,e,n)=>t&e^t&n^e&n,Jr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ge=new Uint32Array(64);class In extends Gr{constructor(){super(64,32,8,!1),this.A=pe[0]|0,this.B=pe[1]|0,this.C=pe[2]|0,this.D=pe[3]|0,this.E=pe[4]|0,this.F=pe[5]|0,this.G=pe[6]|0,this.H=pe[7]|0}get(){const{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(e,n){for(let l=0;l<16;l++,n+=4)ge[l]=e.getUint32(n,!1);for(let l=16;l<64;l++){const y=ge[l-15],w=ge[l-2],d=te(y,7)^te(y,18)^y>>>3,h=te(w,17)^te(w,19)^w>>>10;ge[l]=h+ge[l-7]+d+ge[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){const y=te(c,6)^te(c,11)^te(c,25),w=f+y+Qr(c,a,u)+Jr[l]+ge[l]|0,h=(te(r,2)^te(r,13)^te(r,22))+Xr(r,o,i)|0;f=u,u=a,a=c,c=s+w|0,s=i,i=o,o=r,r=w+h|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,i,s,c,a,u,f)}roundClean(){ge.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class eo extends In{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const tt=dn(()=>new In);dn(()=>new eo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Rn=BigInt(0),nt=BigInt(1),to=BigInt(2),rt=t=>t instanceof Uint8Array,no=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function $e(t){if(!rt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=no[t[n]];return e}function Bn(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function Rt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function ke(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const o=r*2,i=t.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function V(t){return Rt($e(t))}function Bt(t){if(!rt(t))throw new Error("Uint8Array expected");return Rt($e(Uint8Array.from(t).reverse()))}function we(t,e){return ke(t.toString(16).padStart(e*2,"0"))}function On(t,e){return we(t,e).reverse()}function ro(t){return ke(Bn(t))}function z(t,e,n){let r;if(typeof e=="string")try{r=ke(e)}catch(i){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${i}`)}else if(rt(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function Ie(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!rt(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function oo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function io(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function so(t){let e;for(e=0;t>Rn;t>>=nt,e+=1);return e}function co(t,e){return t>>BigInt(e)&nt}const ao=(t,e,n)=>t|(n?nt:Rn)<<BigInt(e),Ot=t=>(to<<BigInt(t-1))-nt,_t=t=>new Uint8Array(t),_n=t=>Uint8Array.from(t);function Tn(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=_t(t),o=_t(t),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...l)=>n(o,r,...l),a=(l=_t())=>{o=c(_n([0]),l),r=c(),l.length!==0&&(o=c(_n([1]),l),r=c())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const y=[];for(;l<e;){r=c();const w=r.slice();y.push(w),l+=r.length}return Ie(...y)};return(l,y)=>{s(),a(l);let w;for(;!(w=y(u()));)a();return s(),w}}const uo={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ve(t,e,n={}){const r=(o,i,s)=>{const c=uo[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);const a=t[o];if(!(s&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${i}`)};for(const[o,i]of Object.entries(e))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return t}const fo=Object.freeze(Object.defineProperty({__proto__:null,bitGet:co,bitLen:so,bitMask:Ot,bitSet:ao,bytesToHex:$e,bytesToNumberBE:V,bytesToNumberLE:Bt,concatBytes:Ie,createHmacDrbg:Tn,ensureBytes:z,equalBytes:oo,hexToBytes:ke,hexToNumber:Rt,numberToBytesBE:we,numberToBytesLE:On,numberToHexUnpadded:Bn,numberToVarBytesBE:ro,utf8ToBytes:io,validateObject:Ve},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const H=BigInt(0),q=BigInt(1),Re=BigInt(2),lo=BigInt(3),Tt=BigInt(4),$n=BigInt(5),kn=BigInt(8);BigInt(9),BigInt(16);function D(t,e){const n=t%e;return n>=H?n:e+n}function ho(t,e,n){if(n<=H||e<H)throw new Error("Expected power/modulo > 0");if(n===q)return H;let r=q;for(;e>H;)e&q&&(r=r*t%n),t=t*t%n,e>>=q;return r}function X(t,e,n){let r=t;for(;e-- >H;)r*=r,r%=n;return r}function $t(t,e){if(t===H||e<=H)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=D(t,e),r=e,o=H,i=q;for(;n!==H;){const c=r/n,a=r%n,u=o-i*c;r=n,n=a,o=i,i=u}if(r!==q)throw new Error("invert: does not exist");return D(o,e)}function yo(t){const e=(t-q)/Re;let n,r,o;for(n=t-q,r=0;n%Re===H;n/=Re,r++);for(o=Re;o<t&&ho(o,e,t)!==t-q;o++);if(r===1){const s=(t+q)/Tt;return function(a,u){const f=a.pow(u,s);if(!a.eql(a.sqr(f),u))throw new Error("Cannot find square root");return f}}const i=(n+q)/Re;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,f=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,i),y=c.pow(a,n);for(;!c.eql(y,c.ONE);){if(c.eql(y,c.ZERO))return c.ZERO;let w=1;for(let h=c.sqr(y);w<u&&!c.eql(h,c.ONE);w++)h=c.sqr(h);const d=c.pow(f,q<<BigInt(u-w-1));f=c.sqr(d),l=c.mul(l,d),y=c.mul(y,f),u=w}return l}}function po(t){if(t%Tt===lo){const e=(t+q)/Tt;return function(r,o){const i=r.pow(o,e);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(t%kn===$n){const e=(t-$n)/kn;return function(r,o){const i=r.mul(o,Re),s=r.pow(i,e),c=r.mul(o,s),a=r.mul(r.mul(c,Re),s),u=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return yo(t)}const go=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wo(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=go.reduce((r,o)=>(r[o]="function",r),e);return Ve(t,n)}function bo(t,e,n){if(n<H)throw new Error("Expected power > 0");if(n===H)return t.ONE;if(n===q)return e;let r=t.ONE,o=e;for(;n>H;)n&q&&(r=t.mul(r,o)),o=t.sqr(o),n>>=q;return r}function vo(t,e){const n=new Array(e.length),r=e.reduce((i,s,c)=>t.is0(s)?i:(n[c]=i,t.mul(i,s)),t.ONE),o=t.inv(r);return e.reduceRight((i,s,c)=>t.is0(s)?i:(n[c]=t.mul(i,n[c]),t.mul(i,s)),o),n}function kt(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function mo(t,e,n=!1,r={}){if(t<=H)throw new Error(`Expected Fp ORDER > 0, got ${t}`);const{nBitLength:o,nByteLength:i}=kt(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=po(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:i,MASK:Ot(o),ZERO:H,ONE:q,create:a=>D(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return H<=a&&a<t},is0:a=>a===H,isOdd:a=>(a&q)===q,neg:a=>D(-a,t),eql:(a,u)=>a===u,sqr:a=>D(a*a,t),add:(a,u)=>D(a+u,t),sub:(a,u)=>D(a-u,t),mul:(a,u)=>D(a*u,t),pow:(a,u)=>bo(c,a,u),div:(a,u)=>D(a*$t(u,t),t),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>$t(a,t),sqrt:r.sqrt||(a=>s(c,a)),invertBatch:a=>vo(c,a),cmov:(a,u,f)=>f?u:a,toBytes:a=>n?On(a,i):we(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?Bt(a):V(a)}});return Object.freeze(c)}function Eo(t,e,n=!1){t=z("privateHash",t);const r=t.length,o=kt(e).nByteLength+8;if(o<24||r<o||r>1024)throw new Error(`hashToPrivateScalar: expected ${o}-1024 bytes of input, got ${r}`);const i=n?Bt(t):V(t);return D(i,e-q)+q}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xo=BigInt(0),qt=BigInt(1);function So(t,e){const n=(o,i)=>{const s=i.negate();return o?s:i},r=o=>{const i=Math.ceil(e/o)+1,s=2**(o-1);return{windows:i,windowSize:s}};return{constTimeNegate:n,unsafeLadder(o,i){let s=t.ZERO,c=o;for(;i>xo;)i&qt&&(s=s.add(c)),c=c.double(),i>>=qt;return s},precomputeWindow(o,i){const{windows:s,windowSize:c}=r(i),a=[];let u=o,f=u;for(let l=0;l<s;l++){f=u,a.push(f);for(let y=1;y<c;y++)f=f.add(u),a.push(f);u=f.double()}return a},wNAF(o,i,s){const{windows:c,windowSize:a}=r(o);let u=t.ZERO,f=t.BASE;const l=BigInt(2**o-1),y=2**o,w=BigInt(o);for(let d=0;d<c;d++){const h=d*a;let p=Number(s&l);s>>=w,p>a&&(p-=y,s+=qt);const g=h,m=h+Math.abs(p)-1,I=d%2!==0,S=p<0;p===0?f=f.add(n(I,i[g])):u=u.add(n(S,i[m]))}return{p:u,f}},wNAFCached(o,i,s,c){const a=o._WINDOW_SIZE||1;let u=i.get(o);return u||(u=this.precomputeWindow(o,a),a!==1&&i.set(o,c(u))),this.wNAF(a,u,s)}}}function qn(t){return wo(t.Fp),Ve(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...kt(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ao(t){const e=qn(t);Ve(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Io,hexToBytes:Ro}=fo,Be={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=Be;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:Io(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Be,n=typeof t=="string"?Ro(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:o,l:i}=Be._parseInt(n.subarray(2)),{d:s,l:c}=Be._parseInt(i);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(t){const e=u=>Number.parseInt(u[0],16)&8?"00"+u:u,n=u=>{const f=u.toString(16);return f.length&1?`0${f}`:f},r=e(n(t.s)),o=e(n(t.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},fe=BigInt(0),J=BigInt(1);BigInt(2);const Pn=BigInt(3);BigInt(4);function Bo(t){const e=Ao(t),{Fp:n}=e,r=e.toBytes||((d,h,p)=>{const g=h.toAffine();return Ie(Uint8Array.from([4]),n.toBytes(g.x),n.toBytes(g.y))}),o=e.fromBytes||(d=>{const h=d.subarray(1),p=n.fromBytes(h.subarray(0,n.BYTES)),g=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:p,y:g}});function i(d){const{a:h,b:p}=e,g=n.sqr(d),m=n.mul(g,d);return n.add(n.add(m,n.mul(d,h)),p)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function s(d){return typeof d=="bigint"&&fe<d&&d<e.n}function c(d){if(!s(d))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(d){const{allowedPrivateKeyLengths:h,nByteLength:p,wrapPrivateKey:g,n:m}=e;if(h&&typeof d!="bigint"){if(d instanceof Uint8Array&&(d=$e(d)),typeof d!="string"||!h.includes(d.length))throw new Error("Invalid key");d=d.padStart(p*2,"0")}let I;try{I=typeof d=="bigint"?d:V(z("private key",d,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof d}`)}return g&&(I=D(I,m)),c(I),I}const u=new Map;function f(d){if(!(d instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(h,p,g){if(this.px=h,this.py=p,this.pz=g,h==null||!n.isValid(h))throw new Error("x required");if(p==null||!n.isValid(p))throw new Error("y required");if(g==null||!n.isValid(g))throw new Error("z required")}static fromAffine(h){const{x:p,y:g}=h||{};if(!h||!n.isValid(p)||!n.isValid(g))throw new Error("invalid affine point");if(h instanceof l)throw new Error("projective point not allowed");const m=I=>n.eql(I,n.ZERO);return m(p)&&m(g)?l.ZERO:new l(p,g,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){const p=n.invertBatch(h.map(g=>g.pz));return h.map((g,m)=>g.toAffine(p[m])).map(l.fromAffine)}static fromHex(h){const p=l.fromAffine(o(z("pointHex",h)));return p.assertValidity(),p}static fromPrivateKey(h){return l.BASE.multiply(a(h))}_setWindowSize(h){this._WINDOW_SIZE=h,u.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint)return;throw new Error("bad point: ZERO")}const{x:h,y:p}=this.toAffine();if(!n.isValid(h)||!n.isValid(p))throw new Error("bad point: x or y not FE");const g=n.sqr(p),m=i(h);if(!n.eql(g,m))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);const{px:p,py:g,pz:m}=this,{px:I,py:S,pz:x}=h,v=n.eql(n.mul(p,x),n.mul(I,m)),A=n.eql(n.mul(g,x),n.mul(S,m));return v&&A}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:h,b:p}=e,g=n.mul(p,Pn),{px:m,py:I,pz:S}=this;let x=n.ZERO,v=n.ZERO,A=n.ZERO,B=n.mul(m,m),N=n.mul(I,I),$=n.mul(S,S),_=n.mul(m,I);return _=n.add(_,_),A=n.mul(m,S),A=n.add(A,A),x=n.mul(h,A),v=n.mul(g,$),v=n.add(x,v),x=n.sub(N,v),v=n.add(N,v),v=n.mul(x,v),x=n.mul(_,x),A=n.mul(g,A),$=n.mul(h,$),_=n.sub(B,$),_=n.mul(h,_),_=n.add(_,A),A=n.add(B,B),B=n.add(A,B),B=n.add(B,$),B=n.mul(B,_),v=n.add(v,B),$=n.mul(I,S),$=n.add($,$),B=n.mul($,_),x=n.sub(x,B),A=n.mul($,N),A=n.add(A,A),A=n.add(A,A),new l(x,v,A)}add(h){f(h);const{px:p,py:g,pz:m}=this,{px:I,py:S,pz:x}=h;let v=n.ZERO,A=n.ZERO,B=n.ZERO;const N=e.a,$=n.mul(e.b,Pn);let _=n.mul(p,I),W=n.mul(g,S),Z=n.mul(m,x),me=n.add(p,g),b=n.add(I,S);me=n.mul(me,b),b=n.add(_,W),me=n.sub(me,b),b=n.add(p,m);let E=n.add(I,x);return b=n.mul(b,E),E=n.add(_,Z),b=n.sub(b,E),E=n.add(g,m),v=n.add(S,x),E=n.mul(E,v),v=n.add(W,Z),E=n.sub(E,v),B=n.mul(N,b),v=n.mul($,Z),B=n.add(v,B),v=n.sub(W,B),B=n.add(W,B),A=n.mul(v,B),W=n.add(_,_),W=n.add(W,_),Z=n.mul(N,Z),b=n.mul($,b),W=n.add(W,Z),Z=n.sub(_,Z),Z=n.mul(N,Z),b=n.add(b,Z),_=n.mul(W,b),A=n.add(A,_),_=n.mul(E,b),v=n.mul(me,v),v=n.sub(v,_),_=n.mul(me,W),B=n.mul(E,B),B=n.add(B,_),new l(v,A,B)}subtract(h){return this.add(h.negate())}is0(){return this.equals(l.ZERO)}wNAF(h){return w.wNAFCached(this,u,h,p=>{const g=n.invertBatch(p.map(m=>m.pz));return p.map((m,I)=>m.toAffine(g[I])).map(l.fromAffine)})}multiplyUnsafe(h){const p=l.ZERO;if(h===fe)return p;if(c(h),h===J)return this;const{endo:g}=e;if(!g)return w.unsafeLadder(this,h);let{k1neg:m,k1:I,k2neg:S,k2:x}=g.splitScalar(h),v=p,A=p,B=this;for(;I>fe||x>fe;)I&J&&(v=v.add(B)),x&J&&(A=A.add(B)),B=B.double(),I>>=J,x>>=J;return m&&(v=v.negate()),S&&(A=A.negate()),A=new l(n.mul(A.px,g.beta),A.py,A.pz),v.add(A)}multiply(h){c(h);let p=h,g,m;const{endo:I}=e;if(I){const{k1neg:S,k1:x,k2neg:v,k2:A}=I.splitScalar(p);let{p:B,f:N}=this.wNAF(x),{p:$,f:_}=this.wNAF(A);B=w.constTimeNegate(S,B),$=w.constTimeNegate(v,$),$=new l(n.mul($.px,I.beta),$.py,$.pz),g=B.add($),m=N.add(_)}else{const{p:S,f:x}=this.wNAF(p);g=S,m=x}return l.normalizeZ([g,m])[0]}multiplyAndAddUnsafe(h,p,g){const m=l.BASE,I=(x,v)=>v===fe||v===J||!x.equals(m)?x.multiplyUnsafe(v):x.multiply(v),S=I(this,p).add(I(h,g));return S.is0()?void 0:S}toAffine(h){const{px:p,py:g,pz:m}=this,I=this.is0();h==null&&(h=I?n.ONE:n.inv(m));const S=n.mul(p,h),x=n.mul(g,h),v=n.mul(m,h);if(I)return{x:n.ZERO,y:n.ZERO};if(!n.eql(v,n.ONE))throw new Error("invZ was invalid");return{x:S,y:x}}isTorsionFree(){const{h,isTorsionFree:p}=e;if(h===J)return!0;if(p)return p(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h,clearCofactor:p}=e;return h===J?this:p?p(l,this):this.multiplyUnsafe(e.h)}toRawBytes(h=!0){return this.assertValidity(),r(l,this,h)}toHex(h=!0){return $e(this.toRawBytes(h))}}l.BASE=new l(e.Gx,e.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const y=e.nBitLength,w=So(l,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}function Oo(t){const e=qn(t);return Ve(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function _o(t){const e=Oo(t),{Fp:n,n:r}=e,o=n.BYTES+1,i=2*n.BYTES+1;function s(b){return fe<b&&b<n.ORDER}function c(b){return D(b,r)}function a(b){return $t(b,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:l,isWithinCurveOrder:y}=Bo({...e,toBytes(b,E,O){const k=E.toAffine(),T=n.toBytes(k.x),j=Ie;return O?j(Uint8Array.from([E.hasEvenY()?2:3]),T):j(Uint8Array.from([4]),T,n.toBytes(k.y))},fromBytes(b){const E=b.length,O=b[0],k=b.subarray(1);if(E===o&&(O===2||O===3)){const T=V(k);if(!s(T))throw new Error("Point is not on curve");const j=l(T);let G=n.sqrt(j);const Q=(G&J)===J;return(O&1)===1!==Q&&(G=n.neg(G)),{x:T,y:G}}else if(E===i&&O===4){const T=n.fromBytes(k.subarray(0,n.BYTES)),j=n.fromBytes(k.subarray(n.BYTES,2*n.BYTES));return{x:T,y:j}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}}),w=b=>$e(we(b,e.nByteLength));function d(b){const E=r>>J;return b>E}function h(b){return d(b)?c(-b):b}const p=(b,E,O)=>V(b.slice(E,O));class g{constructor(E,O,k){this.r=E,this.s=O,this.recovery=k,this.assertValidity()}static fromCompact(E){const O=e.nByteLength;return E=z("compactSignature",E,O*2),new g(p(E,0,O),p(E,O,2*O))}static fromDER(E){const{r:O,s:k}=Be.toSig(z("DER",E));return new g(O,k)}assertValidity(){if(!y(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!y(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new g(this.r,this.s,E)}recoverPublicKey(E){const{r:O,s:k,recovery:T}=this,j=A(z("msgHash",E));if(T==null||![0,1,2,3].includes(T))throw new Error("recovery id invalid");const G=T===2||T===3?O+e.n:O;if(G>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Q=T&1?"03":"02",Ee=u.fromHex(Q+w(G)),xe=a(G),He=c(-j*xe),Ge=c(k*xe),Se=u.BASE.multiplyAndAddUnsafe(Ee,He,Ge);if(!Se)throw new Error("point at infinify");return Se.assertValidity(),Se}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return ke(this.toDERHex())}toDERHex(){return Be.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ke(this.toCompactHex())}toCompactHex(){return w(this.r)+w(this.s)}}const m={isValidPrivateKey(b){try{return f(b),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const b=e.randomBytes(n.BYTES+8),E=Eo(b,r);return we(E,e.nByteLength)},precompute(b=8,E=u.BASE){return E._setWindowSize(b),E.multiply(BigInt(3)),E}};function I(b,E=!0){return u.fromPrivateKey(b).toRawBytes(E)}function S(b){const E=b instanceof Uint8Array,O=typeof b=="string",k=(E||O)&&b.length;return E?k===o||k===i:O?k===2*o||k===2*i:b instanceof u}function x(b,E,O=!0){if(S(b))throw new Error("first arg must be private key");if(!S(E))throw new Error("second arg must be public key");return u.fromHex(E).multiply(f(b)).toRawBytes(O)}const v=e.bits2int||function(b){const E=V(b),O=b.length*8-e.nBitLength;return O>0?E>>BigInt(O):E},A=e.bits2int_modN||function(b){return c(v(b))},B=Ot(e.nBitLength);function N(b){if(typeof b!="bigint")throw new Error("bigint expected");if(!(fe<=b&&b<B))throw new Error(`bigint expected < 2^${e.nBitLength}`);return we(b,e.nByteLength)}function $(b,E,O=_){if(["recovered","canonical"].some(_e=>_e in O))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:T}=e;let{lowS:j,prehash:G,extraEntropy:Q}=O;j==null&&(j=!0),b=z("msgHash",b),G&&(b=z("prehashed msgHash",k(b)));const Ee=A(b),xe=f(E),He=[N(xe),N(Ee)];if(Q!=null){const _e=Q===!0?T(n.BYTES):Q;He.push(z("extraEntropy",_e,n.BYTES))}const Ge=Ie(...He),Se=Ee;function un(_e){const je=v(_e);if(!y(je))return;const $r=a(je),ze=u.BASE.multiply(je).toAffine(),ee=c(ze.x);if(ee===fe)return;const De=c($r*c(Se+ee*xe));if(De===fe)return;let kr=(ze.x===ee?0:2)|Number(ze.y&J),qr=De;return j&&d(De)&&(qr=h(De),kr^=1),new g(ee,qr,kr)}return{seed:Ge,k2sig:un}}const _={lowS:e.lowS,prehash:!1},W={lowS:e.lowS,prehash:!1};function Z(b,E,O=_){const{seed:k,k2sig:T}=$(b,E,O),j=e;return Tn(j.hash.outputLen,j.nByteLength,j.hmac)(k,T)}u.BASE._setWindowSize(8);function me(b,E,O,k=W){var ze;const T=b;if(E=z("msgHash",E),O=z("publicKey",O),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:j,prehash:G}=k;let Q,Ee;try{if(typeof T=="string"||T instanceof Uint8Array)try{Q=g.fromDER(T)}catch(ee){if(!(ee instanceof Be.Err))throw ee;Q=g.fromCompact(T)}else if(typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint"){const{r:ee,s:De}=T;Q=new g(ee,De)}else throw new Error("PARSE");Ee=u.fromHex(O)}catch(ee){if(ee.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(j&&Q.hasHighS())return!1;G&&(E=e.hash(E));const{r:xe,s:He}=Q,Ge=A(E),Se=a(He),un=c(Ge*Se),_e=c(xe*Se),je=(ze=u.BASE.multiplyAndAddUnsafe(Ee,un,_e))==null?void 0:ze.toAffine();return je?c(je.x)===xe:!1}return{CURVE:e,getPublicKey:I,getSharedSecret:x,sign:Z,verify:me,ProjectivePoint:u,Signature:g,utils:m}}class Cn extends hn{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Ae.hash(e);const r=mt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return Ae.exists(this),this.iHash.update(e),this}digestInto(e){Ae.exists(this),Ae.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Nn=(t,e,n)=>new Cn(t,e).update(n).digest();Nn.create=(t,e)=>new Cn(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function To(t){return{hash:t,hmac:(e,...n)=>Nn(t,e,Nr(...n)),randomBytes:yn}}function $o(t,e){const n=r=>_o({...t,...To(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ot=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),it=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Un=BigInt(1),st=BigInt(2),Ln=(t,e)=>(t+e/st)/e;function Hn(t){const e=ot,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),u=t*t*t%e,f=u*u*t%e,l=X(f,n,e)*f%e,y=X(l,n,e)*f%e,w=X(y,st,e)*u%e,d=X(w,o,e)*w%e,h=X(d,i,e)*d%e,p=X(h,c,e)*h%e,g=X(p,a,e)*p%e,m=X(g,c,e)*h%e,I=X(m,n,e)*f%e,S=X(I,s,e)*d%e,x=X(S,r,e)*u%e,v=X(x,st,e);if(!Pt.eql(Pt.sqr(v),t))throw new Error("Cannot find square root");return v}const Pt=mo(ot,void 0,void 0,{sqrt:Hn}),Ct=$o({a:BigInt(0),b:BigInt(7),Fp:Pt,n:it,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=it,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Un*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=Ln(i*t,e),a=Ln(-r*t,e);let u=D(t-c*n-a*o,e),f=D(-c*r-a*i,e);const l=u>s,y=f>s;if(l&&(u=e-u),y&&(f=e-f),u>s||f>s)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:y,k2:f}}}},tt),ct=BigInt(0),jn=t=>typeof t=="bigint"&&ct<t&&t<ot,ko=t=>typeof t=="bigint"&&ct<t&&t<it,zn={};function at(t,...e){let n=zn[t];if(n===void 0){const r=tt(Uint8Array.from(t,o=>o.charCodeAt(0)));n=Ie(r,r),zn[t]=n}return tt(Ie(n,...e))}const Nt=t=>t.toRawBytes(!0).slice(1),Ut=t=>we(t,32),Lt=t=>D(t,ot),Fe=t=>D(t,it),Ht=Ct.ProjectivePoint,qo=(t,e,n)=>Ht.BASE.multiplyAndAddUnsafe(t,e,n);function jt(t){let e=Ct.utils.normPrivateKeyToScalar(t),n=Ht.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Fe(-e),bytes:Nt(n)}}function Dn(t){if(!jn(t))throw new Error("bad x: need 0 < x < p");const e=Lt(t*t),n=Lt(e*t+BigInt(7));let r=Hn(n);r%st!==ct&&(r=Lt(-r));const o=new Ht(t,r,Un);return o.assertValidity(),o}function Wn(...t){return Fe(V(at("BIP0340/challenge",...t)))}function Po(t){return jt(t).bytes}function Co(t,e,n=yn(32)){const r=z("message",t),{bytes:o,scalar:i}=jt(e),s=z("auxRand",n,32),c=Ut(i^V(at("BIP0340/aux",s))),a=at("BIP0340/nonce",c,o,r),u=Fe(V(a));if(u===ct)throw new Error("sign failed: k is zero");const{bytes:f,scalar:l}=jt(u),y=Wn(f,o,r),w=new Uint8Array(64);if(w.set(f,0),w.set(Ut(Fe(l+y*i)),32),!Vn(w,r,o))throw new Error("sign: Invalid signature produced");return w}function Vn(t,e,n){const r=z("signature",t,64),o=z("message",e),i=z("publicKey",n,32);try{const s=Dn(V(i)),c=V(r.subarray(0,32));if(!jn(c))return!1;const a=V(r.subarray(32,64));if(!ko(a))return!1;const u=Wn(Ut(c),Nt(s),o),f=qo(s,a,Fe(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const zt=(()=>({getPublicKey:Po,sign:Co,verify:Vn,utils:{randomPrivateKey:Ct.utils.randomPrivateKey,lift_x:Dn,pointToBytes:Nt,numberToBytesBE:we,bytesToNumberBE:V,taggedHash:at,mod:D}}))(),No=new TextEncoder;async function Fn(t,e){var o;const n={...t,pubkey:t.pubkey??await r(),tags:t.tags??[],created_at:t.created_at??Math.floor(new Date().getTime()/1e3)};if(Lo(t))return t;if(e){const i=n.id??Wt(n),s=e.startsWith("nsec1")?et(e):e;return{...n,id:i,sig:n.sig??Mn(i,s)}}else{const i=(o=window??{})==null?void 0:o.nostr;if(!i)throw new Error("Couldn't get sig. To automatically calculate signature, a seckey argument or NIP-07 environment is required.");return i.signEvent({kind:n.kind,tags:n.tags,content:n.content,created_at:n.created_at})}async function r(){var i;if(t.pubkey)return t.pubkey.startsWith("npub1")?et(t.pubkey):t.pubkey;if(e)return e.startsWith("nsec1")?Dt(et(e)):Dt(e);{const s=await((i=window==null?void 0:window.nostr)==null?void 0:i.getPublicKey());if(!s)throw new Error("Couldn't get pubkey. To automatically calculate pubkey, a seckey argument or NIP-07 environment is required.");return s}}}function Dt(t){return Qe(zt.getPublicKey(t))}function Wt(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return Qe(tt(No.encode(e)))}function Mn(t,e){return Qe(zt.sign(t,e))}function Uo(t){try{return zt.verify(t.sig,Wt(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function Lo(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Ho(t,e){return qe(t,e)<0?t:e}function jo(t,e){return qe(t,e)<0?e:t}function qe(t,e){return t.id===e.id?0:t.created_at<e.created_at||t.created_at===e.created_at&&t.id<e.id?-1:1}const zo="text/plain",Do="us-ascii",Vt=(t,e)=>e.some(n=>n instanceof RegExp?n.test(t):n===t),Wo=new Set(["https:","http:","file:"]),Vo=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!Wo.has(e)}catch{return!1}},Fo=(t,{stripHash:e})=>{var l;const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let{type:r,data:o,hash:i}=n.groups;const s=r.split(";");i=e?"":i;let c=!1;s[s.length-1]==="base64"&&(s.pop(),c=!0);const a=((l=s.shift())==null?void 0:l.toLowerCase())??"",f=[...s.map(y=>{let[w,d=""]=y.split("=").map(h=>h.trim());return w==="charset"&&(d=d.toLowerCase(),d===Do)?"":`${w}${d?`=${d}`:""}`}).filter(Boolean)];return c&&f.push("base64"),(f.length>0||a&&a!==zo)&&f.unshift(a),`data:${f.join(";")},${c?o.trim():o}${i?`#${i}`:""}`};function Mo(t,e){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),t=t.trim(),/^data:/i.test(t))return Fo(t,e);if(Vo(t))return t;const n=t.startsWith("//");!n&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const o=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&o.protocol==="https:"&&(o.protocol="http:"),e.forceHttps&&o.protocol==="http:"&&(o.protocol="https:"),e.stripAuthentication&&(o.username="",o.password=""),e.stripHash?o.hash="":e.stripTextFragment&&(o.hash=o.hash.replace(/#?:~:text.*?$/i,"")),o.pathname){const s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let c=0,a="";for(;;){const f=s.exec(o.pathname);if(!f)break;const l=f[0],y=f.index,w=o.pathname.slice(c,y);a+=w.replace(/\/{2,}/g,"/"),a+=l,c=y+l.length}const u=o.pathname.slice(c,o.pathname.length);a+=u.replace(/\/{2,}/g,"/"),o.pathname=a}if(o.pathname)try{o.pathname=decodeURI(o.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let s=o.pathname.split("/");const c=s[s.length-1];Vt(c,e.removeDirectoryIndex)&&(s=s.slice(0,-1),o.pathname=s.slice(1).join("/")+"/")}if(o.hostname&&(o.hostname=o.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(o.hostname)&&(o.hostname=o.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const s of[...o.searchParams.keys()])Vt(s,e.removeQueryParameters)&&o.searchParams.delete(s);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(o.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const s of[...o.searchParams.keys()])Vt(s,e.keepQueryParameters)||o.searchParams.delete(s);if(e.sortQueryParameters){o.searchParams.sort();try{o.search=decodeURIComponent(o.search)}catch{}}e.removeTrailingSlash&&(o.pathname=o.pathname.replace(/\/$/,"")),e.removeExplicitPort&&o.port&&(o.port="");const i=t;return t=o.toString(),!e.removeSingleSlash&&o.pathname==="/"&&!i.endsWith("/")&&o.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||o.pathname==="/")&&o.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),n&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}function Me(t){return e=>Object.fromEntries(Object.keys(t).map(n=>[n,(e==null?void 0:e[n])??t[n]]))}function ne(t){return Mo(t,{normalizeProtocol:!1,removeTrailingSlash:!0})}const Yo=Me({sinceInclusive:!0,untilInclusive:!0});function Ft(t,e,n){return Array.isArray(e)?e.some(r=>Yn(t,r,n)):Yn(t,e,n)}function Yn(t,e,n){const{sinceInclusive:r,untilInclusive:o}=Yo(n);if(e.ids&&e.ids.every(i=>!t.id.startsWith(i))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(i=>!t.pubkey.startsWith(i))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(o&&!(t.created_at<=e.until)||!o&&!(t.created_at<e.until)))return!1;for(const[i,s]of Object.entries(e)){if(!i.startsWith("#")||!Array.isArray(s))continue;const c=i.slice(1);if(!t.tags.find(([a,u])=>c===a&&s.includes(u)))return!1}return!0}async function Mt(t){const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}var Yt=function(t,e){return Yt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},Yt(t,e)};function re(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Yt(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Ko(t,e,n,r){function o(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function c(f){try{u(r.next(f))}catch(l){s(l)}}function a(f){try{u(r.throw(f))}catch(l){s(l)}}function u(f){f.done?i(f.value):o(f.value).then(c,a)}u((r=r.apply(t,e||[])).next())})}function Kn(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(u){return function(f){return a([u,f])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(n=0)),n;)try{if(r=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,o=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(f){u=[6,f],o=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Pe(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ce(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(c){s={error:c}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return i}function Ne(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function Ue(t){return this instanceof Ue?(this.v=t,this):new Ue(t)}function Zo(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(y){r[y]&&(o[y]=function(w){return new Promise(function(d,h){i.push([y,w,d,h])>1||c(y,w)})})}function c(y,w){try{a(r[y](w))}catch(d){l(i[0][3],d)}}function a(y){y.value instanceof Ue?Promise.resolve(y.value.v).then(u,f):l(i[0][2],y)}function u(y){c("next",y)}function f(y){c("throw",y)}function l(y,w){y(w),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Go(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Pe=="function"?Pe(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(c,a){s=t[i](s),o(c,a,s.done,s.value)})}}function o(i,s,c,a){Promise.resolve(a).then(function(u){i({value:u,done:c})},s)}}function P(t){return typeof t=="function"}function ut(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Kt=ut(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,o){return o+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ft(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Ye=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=Pe(s),a=c.next();!a.done;a=c.next()){var u=a.value;u.remove(this)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}else s.remove(this);var f=this.initialTeardown;if(P(f))try{f()}catch(h){i=h instanceof Kt?h.errors:[h]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var y=Pe(l),w=y.next();!w.done;w=y.next()){var d=w.value;try{Qn(d)}catch(h){i=i??[],h instanceof Kt?i=Ne(Ne([],Ce(i)),Ce(h.errors)):i.push(h)}}}catch(h){r={error:h}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}}if(i)throw new Kt(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Qn(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&ft(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&ft(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Zn=Ye.EMPTY;function Gn(t){return t instanceof Ye||t&&"closed"in t&&P(t.remove)&&P(t.add)&&P(t.unsubscribe)}function Qn(t){P(t)?t():t.unsubscribe()}var Xn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Zt={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Zt.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,Ne([t,e],Ce(n))):setTimeout.apply(void 0,Ne([t,e],Ce(n)))},clearTimeout:function(t){var e=Zt.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Jn(t){Zt.setTimeout(function(){throw t})}function Ke(){}function lt(t){t()}var Gt=function(t){re(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Gn(n)&&n.add(r)):r.destination=ei,r}return e.create=function(n,r,o){return new Xt(n,r,o)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ye),Qo=Function.prototype.bind;function Qt(t,e){return Qo.call(t,e)}var Xo=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){ht(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){ht(r)}else ht(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){ht(n)}},t}(),Xt=function(t){re(e,t);function e(n,r,o){var i=t.call(this)||this,s;if(P(n)||!n)s={next:n??void 0,error:r??void 0,complete:o??void 0};else{var c;i&&Xn.useDeprecatedNextContext?(c=Object.create(n),c.unsubscribe=function(){return i.unsubscribe()},s={next:n.next&&Qt(n.next,c),error:n.error&&Qt(n.error,c),complete:n.complete&&Qt(n.complete,c)}):s=n}return i.destination=new Xo(s),i}return e}(Gt);function ht(t){Jn(t)}function Jo(t){throw t}var ei={closed:!0,next:Ke,error:Jo,complete:Ke},Jt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function le(t){return t}function Ze(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return er(t)}function er(t){return t.length===0?le:t.length===1?t[0]:function(n){return t.reduce(function(r,o){return o(r)},n)}}var F=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var o=this,i=ni(e)?e:new Xt(e,n,r);return lt(function(){var s=o,c=s.operator,a=s.source;i.add(c?c.call(i,a):a?o._subscribe(i):o._trySubscribe(i))}),i},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=tr(n),new n(function(o,i){var s=new Xt({next:function(c){try{e(c)}catch(a){i(a),s.unsubscribe()}},error:i,complete:o});r.subscribe(s)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Jt]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return er(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=tr(e),new e(function(r,o){var i;n.subscribe(function(s){return i=s},function(s){return o(s)},function(){return r(i)})})},t.create=function(e){return new t(e)},t}();function tr(t){var e;return(e=t??Xn.Promise)!==null&&e!==void 0?e:Promise}function ti(t){return t&&P(t.next)&&P(t.error)&&P(t.complete)}function ni(t){return t&&t instanceof Gt||ti(t)&&Gn(t)}function ri(t){return P(t==null?void 0:t.lift)}function L(t){return function(e){if(ri(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function C(t,e,n,r,o){return new nr(t,e,n,r,o)}var nr=function(t){re(e,t);function e(n,r,o,i,s,c){var a=t.call(this,n)||this;return a.onFinalize=s,a.shouldUnsubscribe=c,a._next=r?function(u){try{r(u)}catch(f){n.error(f)}}:t.prototype._next,a._error=i?function(u){try{i(u)}catch(f){n.error(f)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=o?function(){try{o()}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Gt),oi=ut(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Y=function(t){re(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new rr(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new oi},e.prototype.next=function(n){var r=this;lt(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=Pe(r.currentObservers),c=s.next();!c.done;c=s.next()){var a=c.value;a.next(n)}}catch(u){o={error:u}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},e.prototype.error=function(n){var r=this;lt(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var o=r.observers;o.length;)o.shift().error(n)}})},e.prototype.complete=function(){var n=this;lt(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,o=this,i=o.hasError,s=o.isStopped,c=o.observers;return i||s?Zn:(this.currentObservers=null,c.push(n),new Ye(function(){r.currentObservers=null,ft(c,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,o=r.hasError,i=r.thrownError,s=r.isStopped;o?n.error(i):s&&n.complete()},e.prototype.asObservable=function(){var n=new F;return n.source=this,n},e.create=function(n,r){return new rr(n,r)},e}(F),rr=function(t){re(e,t);function e(n,r){var o=t.call(this)||this;return o.destination=n,o.source=r,o}return e.prototype.next=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,n)},e.prototype.error=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&o!==void 0?o:Zn},e}(Y),ii=function(t){re(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,o=n.thrownError,i=n._value;if(r)throw o;return this._throwIfClosed(),i},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Y),en={now:function(){return(en.delegate||Date).now()},delegate:void 0},si=function(t){re(e,t);function e(n,r,o){n===void 0&&(n=1/0),r===void 0&&(r=1/0),o===void 0&&(o=en);var i=t.call(this)||this;return i._bufferSize=n,i._windowTime=r,i._timestampProvider=o,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,n),i._windowTime=Math.max(1,r),i}return e.prototype.next=function(n){var r=this,o=r.isStopped,i=r._buffer,s=r._infiniteTimeWindow,c=r._timestampProvider,a=r._windowTime;o||(i.push(n),!s&&i.push(c.now()+a)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),o=this,i=o._infiniteTimeWindow,s=o._buffer,c=s.slice(),a=0;a<c.length&&!n.closed;a+=i?1:2)n.next(c[a]);return this._checkFinalizedStatuses(n),r},e.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,o=n._timestampProvider,i=n._buffer,s=n._infiniteTimeWindow,c=(s?1:2)*r;if(r<1/0&&c<i.length&&i.splice(0,i.length-c),!s){for(var a=o.now(),u=0,f=1;f<i.length&&i[f]<=a;f+=2)u=f;u&&i.splice(0,u+1)}},e}(Y),ci=function(t){re(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Ye),dt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=dt.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,Ne([t,e],Ce(n))):setInterval.apply(void 0,Ne([t,e],Ce(n)))},clearInterval:function(t){var e=dt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},ai=function(t){re(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),dt.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&dt.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(s){o=!0,i=s||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ft(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(ci),or=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=en.now,t}(),ui=function(t){re(e,t);function e(n,r){r===void 0&&(r=or.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(or),tn=new ui(ai),fi=tn,be=new F(function(t){return t.complete()});function ir(t){return t&&P(t.schedule)}function sr(t){return t[t.length-1]}function nn(t){return ir(sr(t))?t.pop():void 0}function li(t,e){return typeof sr(t)=="number"?t.pop():e}var cr=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function ar(t){return P(t==null?void 0:t.then)}function ur(t){return P(t[Jt])}function fr(t){return Symbol.asyncIterator&&P(t==null?void 0:t[Symbol.asyncIterator])}function lr(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function hi(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var hr=hi();function dr(t){return P(t==null?void 0:t[hr])}function yr(t){return Zo(this,arguments,function(){var n,r,o,i;return Kn(this,function(s){switch(s.label){case 0:n=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Ue(n.read())];case 3:return r=s.sent(),o=r.value,i=r.done,i?[4,Ue(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Ue(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function pr(t){return P(t==null?void 0:t.getReader)}function K(t){if(t instanceof F)return t;if(t!=null){if(ur(t))return di(t);if(cr(t))return yi(t);if(ar(t))return pi(t);if(fr(t))return gr(t);if(dr(t))return gi(t);if(pr(t))return wi(t)}throw lr(t)}function di(t){return new F(function(e){var n=t[Jt]();if(P(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function yi(t){return new F(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function pi(t){return new F(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Jn)})}function gi(t){return new F(function(e){var n,r;try{for(var o=Pe(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(c){n={error:c}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()})}function gr(t){return new F(function(e){bi(t,e).catch(function(n){return e.error(n)})})}function wi(t){return gr(yr(t))}function bi(t,e){var n,r,o,i;return Ko(this,void 0,void 0,function(){var s,c;return Kn(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=Go(t),a.label=1;case 1:return[4,n.next()];case 2:if(r=a.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=a.sent(),o={error:c},[3,11];case 6:return a.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function he(t,e,n,r,o){r===void 0&&(r=0),o===void 0&&(o=!1);var i=e.schedule(function(){n(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function wr(t,e){return e===void 0&&(e=0),L(function(n,r){n.subscribe(C(r,function(o){return he(r,t,function(){return r.next(o)},e)},function(){return he(r,t,function(){return r.complete()},e)},function(o){return he(r,t,function(){return r.error(o)},e)}))})}function br(t,e){return e===void 0&&(e=0),L(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function vi(t,e){return K(t).pipe(br(e),wr(e))}function mi(t,e){return K(t).pipe(br(e),wr(e))}function Ei(t,e){return new F(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function xi(t,e){return new F(function(n){var r;return he(n,e,function(){r=t[hr](),he(n,e,function(){var o,i,s;try{o=r.next(),i=o.value,s=o.done}catch(c){n.error(c);return}s?n.complete():n.next(i)},0,!0)}),function(){return P(r==null?void 0:r.return)&&r.return()}})}function vr(t,e){if(!t)throw new Error("Iterable cannot be null");return new F(function(n){he(n,e,function(){var r=t[Symbol.asyncIterator]();he(n,e,function(){r.next().then(function(o){o.done?n.complete():n.next(o.value)})},0,!0)})})}function Si(t,e){return vr(yr(t),e)}function Ai(t,e){if(t!=null){if(ur(t))return vi(t,e);if(cr(t))return Ei(t,e);if(ar(t))return mi(t,e);if(fr(t))return vr(t,e);if(dr(t))return xi(t,e);if(pr(t))return Si(t,e)}throw lr(t)}function rn(t,e){return e?Ai(t,e):K(t)}function de(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=nn(t);return rn(t,n)}var mr=ut(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Er(t){return t instanceof Date&&!isNaN(t)}var xr=ut(function(t){return function(n){n===void 0&&(n=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=n}});function Sr(t,e){var n=Er(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,o=n.each,i=n.with,s=i===void 0?Ii:i,c=n.scheduler,a=c===void 0?e??tn:c,u=n.meta,f=u===void 0?null:u;if(r==null&&o==null)throw new TypeError("No timeout provided.");return L(function(l,y){var w,d,h=null,p=0,g=function(m){d=he(y,a,function(){try{w.unsubscribe(),K(s({meta:f,lastValue:h,seen:p})).subscribe(y)}catch(I){y.error(I)}},m)};w=l.subscribe(C(y,function(m){d==null||d.unsubscribe(),p++,y.next(h=m),o>0&&g(o)},void 0,void 0,function(){d!=null&&d.closed||d==null||d.unsubscribe(),h=null})),!p&&g(r!=null?typeof r=="number"?r:+r-a.now():o)})}function Ii(t){throw new xr(t)}function oe(t,e){return L(function(n,r){var o=0;n.subscribe(C(r,function(i){r.next(t.call(e,i,o++))}))})}function Ri(t,e,n,r,o,i,s,c){var a=[],u=0,f=0,l=!1,y=function(){l&&!a.length&&!u&&e.complete()},w=function(h){return u<r?d(h):a.push(h)},d=function(h){i&&e.next(h),u++;var p=!1;K(n(h,f++)).subscribe(C(e,function(g){o==null||o(g),i?w(g):e.next(g)},function(){p=!0},void 0,function(){if(p)try{u--;for(var g=function(){var m=a.shift();s?he(e,s,function(){return d(m)}):d(m)};a.length&&u<r;)g();y()}catch(m){e.error(m)}}))};return t.subscribe(C(e,w,function(){l=!0,y()})),function(){c==null||c()}}function ve(t,e,n){return n===void 0&&(n=1/0),P(e)?ve(function(r,o){return oe(function(i,s){return e(r,i,o,s)})(K(t(r,o)))},n):(typeof e=="number"&&(n=e),L(function(r,o){return Ri(r,o,t,n)}))}function yt(t){return t===void 0&&(t=1/0),ve(le,t)}function Bi(){return yt(1)}function Oi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Bi()(rn(t,nn(t)))}function pt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=fi);var r=-1;return e!=null&&(ir(e)?n=e:r=e),new F(function(o){var i=Er(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){o.closed||(o.next(s++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function _i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=nn(t),r=li(t,1/0),o=t;return o.length?o.length===1?K(o[0]):yt(r)(rn(o,n)):be}function ie(t,e){return L(function(n,r){var o=0;n.subscribe(C(r,function(i){return t.call(e,i,o++)&&r.next(i)}))})}function on(t){return L(function(e,n){var r=null,o=!1,i;r=e.subscribe(C(n,void 0,void 0,function(s){i=K(t(s,on(t)(e))),r?(r.unsubscribe(),r=null,i.subscribe(n)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(n))})}function Ti(t,e,n,r,o){return function(i,s){var c=n,a=e,u=0;i.subscribe(C(s,function(f){var l=u++;a=c?t(a,f,l):(c=!0,f),r&&s.next(a)},o&&function(){c&&s.next(a),s.complete()}))}}function $i(t){return L(function(e,n){var r=!1;e.subscribe(C(n,function(o){r=!0,n.next(o)},function(){r||n.next(t),n.complete()}))})}function gt(t){return t<=0?function(){return be}:L(function(e,n){var r=0;e.subscribe(C(n,function(o){++r<=t&&(n.next(o),t<=r&&n.complete())}))})}function ki(){return L(function(t,e){t.subscribe(C(e,Ke))})}function qi(t){return oe(function(){return t})}function Ar(t,e){return e?function(n){return Oi(e.pipe(gt(1),ki()),n.pipe(Ar(t)))}:ve(function(n,r){return K(t(n,r)).pipe(gt(1),qi(n))})}function Pi(t,e){e===void 0&&(e=tn);var n=pt(t,e);return Ar(function(){return n})}function Ci(t,e){return L(function(n,r){var o=new Set;n.subscribe(C(r,function(i){var s=t?t(i):i;o.has(s)||(o.add(s),r.next(i))})),e&&K(e).subscribe(C(r,function(){return o.clear()},Ke))})}function Ni(t,e){return e===void 0&&(e=le),t=t??Ui,L(function(n,r){var o,i=!0;n.subscribe(C(r,function(s){var c=e(s);(i||!t(o,c))&&(i=!1,o=c,r.next(s))}))})}function Ui(t,e){return t===e}function Li(t){return t===void 0&&(t=Hi),L(function(e,n){var r=!1;e.subscribe(C(n,function(o){r=!0,n.next(o)},function(){return r?n.complete():n.error(t())}))})}function Hi(){return new mr}function Ir(t){return L(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function ji(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?ie(function(o,i){return t(o,i,r)}):le,gt(1),n?$i(e):Li(function(){return new mr}))}}function zi(t,e,n,r){return L(function(o,i){var s;!e||typeof e=="function"?s=e:(n=e.duration,s=e.element,r=e.connector);var c=new Map,a=function(d){c.forEach(d),d(i)},u=function(d){return a(function(h){return h.error(d)})},f=0,l=!1,y=new nr(i,function(d){try{var h=t(d),p=c.get(h);if(!p){c.set(h,p=r?r():new Y);var g=w(h,p);if(i.next(g),n){var m=C(p,function(){p.complete(),m==null||m.unsubscribe()},void 0,void 0,function(){return c.delete(h)});y.add(K(n(g)).subscribe(m))}}p.next(s?s(d):d)}catch(I){u(I)}},function(){return a(function(d){return d.complete()})},u,function(){return c.clear()},function(){return l=!0,f===0});o.subscribe(y);function w(d,h){var p=new F(function(g){f++;var m=h.subscribe(g);return function(){m.unsubscribe(),--f===0&&l&&y.unsubscribe()}});return p.key=d,p}})}function Di(t){t===void 0&&(t=1/0);var e;t&&typeof t=="object"?e=t:e={count:t};var n=e.count,r=n===void 0?1/0:n,o=e.delay,i=e.resetOnSuccess,s=i===void 0?!1:i;return r<=0?le:L(function(c,a){var u=0,f,l=function(){var y=!1;f=c.subscribe(C(a,function(w){s&&(u=0),a.next(w)},void 0,function(w){if(u++<r){var d=function(){f?(f.unsubscribe(),f=null,l()):y=!0};if(o!=null){var h=typeof o=="number"?pt(o):K(o(w,u)),p=C(a,function(){p.unsubscribe(),d()},function(){a.complete()});h.subscribe(p)}else d()}else a.error(w)})),y&&(f.unsubscribe(),f=null,l())};l()})}function Rr(t,e){return L(Ti(t,e,arguments.length>=2,!0))}function Wi(t){return L(function(e,n){K(t).subscribe(C(n,function(){return n.complete()},Ke)),!n.closed&&e.subscribe(n)})}function Oe(t,e,n){var r=P(t)||e||n?{next:t,error:e,complete:n}:t;return r?L(function(o,i){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var c=!0;o.subscribe(C(i,function(a){var u;(u=r.next)===null||u===void 0||u.call(r,a),i.next(a)},function(){var a;c=!1,(a=r.complete)===null||a===void 0||a.call(r),i.complete()},function(a){var u;c=!1,(u=r.error)===null||u===void 0||u.call(r,a),i.error(a)},function(){var a,u;c&&((a=r.unsubscribe)===null||a===void 0||a.call(r)),(u=r.finalize)===null||u===void 0||u.call(r)}))}):le}function Vi(t){return Ci(({event:e})=>e.id,t)}function Fi(t,e){const n=new Set;return[ie(r=>{var i,s;const o=t(r);return o===null?!0:n.has(o)?((i=e==null?void 0:e.onHit)==null||i.call(e,r,n),!1):(n.add(o),(s=e==null?void 0:e.onCache)==null||s.call(e,r,n),!0)}),n]}function Br(){return Ze(Rr((t,e)=>qe(t.event,e.event)<0?e:t),Ni((t,e)=>t===e,({event:t})=>t.id))}function Mi(t){return Ze(zi(t),oe(Ze(Br())),yt())}function Yi(){return ie(({event:t})=>Uo(t))}function Ki(t){return ie(({event:e})=>e.kind===t)}function Zi(t,e){const{not:n}=ns(e),r=se(t);return ie(({event:o})=>{const i=Ft(o,r,e);return n?!i:i})}function Gi(t){return Rr((e,n)=>{const r=[...e,n].sort((o,i)=>-1*qe(o.event,i.event));return t!==void 0&&r.splice(t),r},[])}function Qi(t,e){return _r(t,e??((n,r)=>qe(n.event,r.event)))}function Xi(t){return ie(e=>e.message[0]===t)}function Ji(t){return oe(e=>e.reduce((n,r)=>n===null?r:r===null?n:(t??ts)(n,r),null))}function es(t,e){return ve(n=>n!==null&&t(n)?de(...e(n)):de(n))}function Or(t){return Ze(Sr(t),on(e=>{if(e instanceof xr)return be;throw e}))}function _r(t,e){const n=[];return Ze(Oe(r=>{n.push(r),n.sort(e)}),Pi(t),oe(()=>{if(n.length<=0)throw new Error("Logic Error: This is rx-nostr's internal bug.");return n.shift()}))}function ts(t,e){return[...t,...e]}const ns=Me({not:!1});class sn{constructor(e){U(this,"filters$",new ii(null));U(this,"_rxReqId");this._rxReqId=e??ls()}get rxReqId(){return this._rxReqId}getReqObservable(){return this.filters$.asObservable()}emit(e){const n=ds(e);n?this.filters$.next(n):this.filters$.next(null)}pipe(...e){const n=this.rxReqId,r=this.strategy;return{...this,get rxReqId(){return n},get strategy(){return r},getReqObservable:()=>this.getReqObservable().pipe(...e)}}}function rs(t){return new os(t)}class os extends sn{constructor(e){super(e)}get strategy(){return"backward"}}function is(t){return new ss(t)}class ss extends sn{constructor(e){super(e)}get strategy(){return"forward"}}function cs(t){return new as(t)}class as extends sn{constructor(e){super(e==null?void 0:e.subId),this.emit(e.filters)}get strategy(){return"oneshot"}}function us(t){return t}function fs(t,e){return Object.assign(t,e())}function ls(){return`${Math.floor(Math.random()*1e6)}`}function hs(t){var o,i;const e={},n=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){e[s]=t[s];continue}if(s==="since"||s==="until"){const c=t[s];if(typeof c!="number"||(c??-1)>=0){e[s]=c;continue}}if((n(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((o=t[s])==null?void 0:o.length)??-1)>0){e[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((i=t[s])==null?void 0:i.length)??-1)>0){e[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){e[s]=t[s];continue}}return!(typeof e.since!="number"||typeof e.until!="number"||e.since<=e.until)||Object.keys(e).length<=0?null:e}function ds(t){if(!t)return null;const e=(Array.isArray(t)?t:[t]).flatMap(n=>hs(n)??[]);return e.length>0?e:null}class ys{constructor(e,n){U(this,"socket",null);U(this,"message$",new Y);U(this,"error$",new Y);U(this,"connectionState$",new Y);U(this,"connectionState","not-started");U(this,"queuedEvents",[]);U(this,"reqs",new Map);U(this,"serverLimitations",null);U(this,"canRetry",!1);this.url=e,this.config=n,this.connectionState$.next("not-started")}get read(){return this.config.read}set read(e){this.config.read=e}get write(){return this.config.write}set write(e){this.config.write=e}get maxConcurrentReqs(){var e;return((e=this.serverLimitations)==null?void 0:e.max_subscriptions)??this.config.maxConcurrentReqsFallback??null}setConnectionState(e){this.connectionState!=="terminated"&&(this.connectionState=e,this.connectionState$.next(e))}async fetchServerLimitationsIfNeeded(){if(!(this.config.disableAutoFetchNip11Limitations||this.serverLimitations))try{const e=await Mt(this.url);this.serverLimitations=e.limitation??null}catch{}}async start(){if(!this.canRetry&&(this.connectionState==="reconnecting"||this.connectionState==="starting"||this.connectionState==="ongoing"))return Promise.resolve();this.canRetry=!1,this.connectionState==="not-started"?this.setConnectionState("starting"):this.setConnectionState("reconnecting"),await this.fetchServerLimitationsIfNeeded();let e;const n=new Promise(a=>{e=a}),r=()=>{this.setConnectionState("ongoing"),e();for(const a of this.queuedEvents)this.sendEVENT(a);this.queuedEvents=[],this.ensureReqs()},o=({data:a})=>{if(this.connectionState!=="terminated")try{this.message$.next({from:this.url,message:JSON.parse(a)})}catch(u){this.error$.next(u)}},i=()=>{e()},s=({code:a})=>{if(!(a===Le.DISPOSED_BY_RX_NOSTR||this.connectionState==="terminated")){c.removeEventListener("open",r),c.removeEventListener("message",o),c.removeEventListener("error",i),c.removeEventListener("close",s),c.close(),this.socket=null;for(const u of this.reqs.values())u.isOngoing=!1;a===Le.DESIRED_BY_RX_NOSTR?this.setConnectionState("not-started"):a===Le.DONT_RETRY?(this.setConnectionState("rejected"),this.message$.next(new cn(a)),e()):(this.canRetry=!0,this.message$.next(new cn(a)),e())}};if(this.connectionState==="terminated")return Promise.resolve();const c=new WebSocket(this.url);return c.addEventListener("open",r),c.addEventListener("message",o),c.addEventListener("error",i),c.addEventListener("close",s),this.socket=c,n}stop(){var e;this.finalizeAllReqs(),(e=this.socket)==null||e.close(Le.DESIRED_BY_RX_NOSTR)}getConnectionState(){return this.connectionState}getMessageObservable(){const e=this.reqs;return this.message$.asObservable().pipe(ve(r=>{if(r instanceof cn){if(r.code===Le.DONT_RETRY)return be;throw r}else return de(r)}),Oe({subscribe:()=>{this.start()}}),this.config.backoff.strategy==="off"?le:Di({delay:(r,o)=>ps(this.config.backoff,o),count:this.config.backoff.maxCount}),Oe({error:()=>{this.setConnectionState("error")}}),n());function n(){return ie(r=>{const[o,i,s]=r.message;if(o!=="EVENT")return!0;const c=e.get(i);if(!c)return!0;const[,,...a]=c.actual;return Ft(s,a)})}}getConnectionStateObservable(){return this.connectionState$.asObservable()}getErrorObservable(){return this.error$.asObservable()}ensureReq(e,n){var i,s;const r=e[1];if(this.connectionState==="terminated"||!this.read||!(n!=null&&n.overwrite)&&((i=this.reqs.get(r))!=null&&i.isOngoing||this.reqs.has(r)&&!Tr(r,this.reqs,this.maxConcurrentReqs)))return;const o=gs(e);if(this.reqs.set(r,{original:e,actual:o,isOngoing:!1}),Tr(r,this.reqs,this.maxConcurrentReqs)){const c=this.reqs.get(r);c&&((s=this.socket)==null?void 0:s.readyState)===WebSocket.OPEN&&(c.isOngoing=!0,this.socket.send(JSON.stringify(o)))}}ensureReqs(){const e=Array.from(this.reqs.values()).slice(0,this.maxConcurrentReqs??void 0);for(const n of e)this.ensureReq(n.original)}finalizeReq(e){var r;if(this.connectionState==="terminated")return;const n=this.reqs.get(e);if(n&&(this.reqs.delete(e),n.isOngoing)){if(((r=this.socket)==null?void 0:r.readyState)===WebSocket.OPEN){const o=["CLOSE",e];this.socket.send(JSON.stringify(o))}this.ensureReqs()}}finalizeAllReqs(){var e;if(this.connectionState!=="terminated"){for(const n of this.reqs.keys())if(((e=this.socket)==null?void 0:e.readyState)===WebSocket.OPEN){const r=["CLOSE",n];this.socket.send(JSON.stringify(r))}this.reqs.clear()}}sendEVENT(e){var n,r;if(this.connectionState!=="terminated"&&this.write)if(((n=this.socket)==null?void 0:n.readyState)===WebSocket.OPEN)this.socket.send(JSON.stringify(e));else if(((r=this.socket)==null?void 0:r.readyState)===WebSocket.CONNECTING)this.queuedEvents.push(e);else{const o=new WebSocket(this.url);o.addEventListener("open",()=>{o.send(JSON.stringify(e))}),o.addEventListener("message",({data:i})=>{try{const s=JSON.parse(i);s[0]==="OK"&&o.close(),this.message$.next({from:this.url,message:s})}catch(s){this.message$.error(s)}}),setTimeout(()=>{(o.readyState===WebSocket.OPEN||o.readyState===WebSocket.CONNECTING)&&o.close()},10*1e3)}}dispose(){var e;this.finalizeAllReqs(),this.setConnectionState("terminated"),(e=this.socket)==null||e.close(Le.DISPOSED_BY_RX_NOSTR),this.socket=null,this.reqs.clear(),this.message$.complete(),this.message$.unsubscribe(),this.connectionState$.complete(),this.connectionState$.unsubscribe(),this.error$.complete(),this.error$.unsubscribe()}}const Le={ABNORMAL_CLOSURE:1006,DONT_RETRY:4e3,DESIRED_BY_RX_NOSTR:4537,DISPOSED_BY_RX_NOSTR:4538};function ps(t,e){if(t.strategy==="exponential"){const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return pt(n)}else return t.strategy==="linear"?pt(t.interval):t.strategy==="immediately"?de(0):be}function gs([t,e,...n]){return[t,e,...se(n)]}function Tr(t,e,n){if(n===null)return!0;const r=Array.from(e.keys()).findIndex(o=>o===t);return r===void 0?!1:r<n}class cn extends Error{constructor(e){super(`WebSocket Error: Socket was closed with code ${e}`),this.code=e}}function ws(t){return new Es(t)}const bs=Me({retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},timeout:1e4,globalRelayConfig:void 0}),vs=Me({scope:void 0}),ms=Me({scope:void 0,seckey:void 0});class Es{constructor(e){U(this,"options");U(this,"connections",new Map);U(this,"ongoings",new Map);U(this,"messageIn$",new Y);U(this,"error$",new Y);U(this,"status$",new Y);U(this,"globalEventPacketPipe",null);U(this,"disposed",!1);const n=bs(e);this.options={...n}}get messageOut$(){return this.messageIn$.pipe(ve(e=>{const n=this.globalEventPacketPipe;if(!n)return de(e);const r=e.message;return r[0]!=="EVENT"?de(e):de({from:e.from,subId:r[1],event:r[2]}).pipe(n,oe(({from:o,subId:i,event:s})=>({from:o,message:["EVENT",i,s]})))}))}getRelays(){return Array.from(this.connections.values()).map(({url:e,read:n,write:r})=>({url:e,read:n,write:r}))}createConnection({url:e,read:n,write:r,disableAutoFetchNip11Limitations:o}){var s,c;const i=new ys(e,{backoff:this.options.retry,read:n,write:r,disableAutoFetchNip11Limitations:o??((s=this.options.globalRelayConfig)==null?void 0:s.disableAutoFetchNip11Limitations),maxConcurrentReqsFallback:(c=this.options.globalRelayConfig)==null?void 0:c.maxConcurrentReqsFallback});return i.getConnectionStateObservable().subscribe(a=>{this.status$.next({from:e,state:a})}),i.getErrorObservable().subscribe(a=>{this.error$.next({from:e,reason:a})}),i.getMessageObservable().pipe(on(a=>(this.error$.next({from:e,reason:a}),be))).subscribe(a=>{this.messageIn$.next(a)}),i}async switchRelays(e){const n=new Map;for(const{url:i,read:s,write:c}of o(e)){const a=this.connections.get(i);this.connections.delete(i),a?(a.read=s,a.write=c,n.set(i,a)):n.set(i,this.createConnection({url:i,read:s,write:c}))}for(const i of this.connections.values())i.dispose();const r=[];for(const i of n.values())i.read?r.push(i.start()):i.stop();if(await Promise.all(r),this.connections=n,this.disposed){for(const i of this.connections.values())i.dispose();return}for(const{req:i,scope:s}of this.ongoings.values())this.ensureReq(i,{scope:s});function o(i){return Array.isArray(i)?i.map(s=>{const c=typeof s=="string"?{url:s,read:!0,write:!0}:s;return c.url=ne(c.url),c}):Object.entries(i).map(([s,c])=>({url:ne(s),...c}))}}async addRelay(e){await this.switchRelays([...this.getRelays(),e])}async removeRelay(e){const n=ne(e),r=this.getRelays(),o=r.filter(i=>i.url!==n);r.length!==o.length&&await this.switchRelays(o)}hasRelay(e){const n=ne(e);return this.getRelays().some(r=>r.url===n)}canWriteRelay(e){const n=ne(e);return this.getRelays().some(r=>r.url===n&&r.write)}canReadRelay(e){const n=ne(e);return this.getRelays().some(r=>r.url===n&&r.read)}async fetchAllRelaysInfo(){const e=await Promise.all(Array.from(this.connections.keys()).map(async n=>[n,await Mt(n).catch(()=>null)]));return Object.fromEntries(e)}getAllRelayState(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,this.getRelayState(e.url)]))}getRelayState(e){const n=this.connections.get(ne(e));if(!n)throw new Error("RelayConfig not found");return(n==null?void 0:n.getConnectionState())??"not-started"}reconnect(e){var n;this.canReadRelay(e)&&((n=this.connections.get(ne(e)))==null||n.start())}setGlobalEventPacketPipe(e){this.globalEventPacketPipe=e}use(e,n){const{scope:r}=vs(n),o=r==null?void 0:r.map(ne),i=this.options.timeout,s=e.strategy,c=e.rxReqId,a=this.messageOut$,u=this.ongoings,f=this.getAllRelayState.bind(this),l=this.createConnectionStateObservable.bind(this),y=this.ensureReq.bind(this),w=this.finalizeReq.bind(this),d=e.getReqObservable().pipe(ie(S=>S!==null),s==="oneshot"?ji():le,h(),s==="forward"?p():le,Oe(S=>{y(S,{overwrite:s==="forward",scope:o})}),oe(([,S])=>S));if(s==="forward"){const S=an({rxReqId:c}),x=[],v=new Y;return x.push(v),v.pipe(Oe({subscribe:()=>{x.push(d.subscribe()),x.push(a.pipe(m(S),I()).subscribe(A=>{v.next(A)}))},finalize:()=>{for(const A of x)A.unsubscribe();w({subId:S})}}))}else return d.pipe(oe(g),yt());function h(){const S=x=>an({rxReqId:c,index:x});switch(s){case"backward":return oe((x,v)=>["REQ",S(v),...x]);case"forward":case"oneshot":return oe(x=>["REQ",S(),...x])}}function p(){const S=v=>{const A=v[1];u.set(A,{req:v,scope:o})},x=v=>{u.delete(v)};return Oe({next:v=>{S(v)},finalize:()=>{x(an({rxReqId:c}))}})}function g(S){const x=new Y,v=new Y,A=new Set,B=_i(x,l()).subscribe(()=>{const N=f();Object.entries(N).every(([_,W])=>o&&!o.includes(_)||W==="error"||W==="terminated"||W==="ongoing"&&A.has(_))&&v.next()});return a.pipe(Wi(v),Or(i),m(S),ie(N=>!A.has(N.from)),Oe(N=>{N.message[0]==="EOSE"&&(A.add(N.from),w({subId:S,url:N.from}),x.next())}),I(),Ir(()=>{w({subId:S}),v.unsubscribe(),x.unsubscribe(),B.unsubscribe()}))}function m(S){return ie(x=>(x.message[0]==="EVENT"||x.message[0]==="EOSE")&&x.message[1]===S)}function I(){return ve(({from:S,message:x})=>x[0]==="EVENT"?de({from:S,subId:x[1],event:x[2]}):be)}}createAllEventObservable(){return this.messageOut$.pipe(ve(({from:e,message:n})=>n[0]==="EVENT"?de({from:e,subId:n[1],event:n[2]}):be))}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.messageOut$}createConnectionStateObservable(){return this.status$.asObservable()}send(e,n){const{seckey:r,scope:o}=ms(n),i=o==null?void 0:o.map(ne),s=Array.from(this.connections.values()).filter(u=>(!i||i.includes(u.url))&&u.write),c=new si(s.length);let a=null;return Fn(e,r).then(u=>{c.closed||(a=this.createAllMessageObservable().subscribe(({from:f,message:l})=>{l[0]==="OK"&&c.next({from:f,id:u.id,ok:l[2]})}));for(const f of s)f.sendEVENT(["EVENT",u])}),c.pipe(gt(s.length),Sr(30*1e3),Ir(()=>{c.complete(),c.unsubscribe(),a==null||a.unsubscribe()}))}dispose(){this.disposed=!0,this.messageIn$.complete(),this.error$.complete();for(const e of this.connections.values())e.dispose()}ensureReq(e,n){const r=n==null?void 0:n.scope;for(const o of this.connections.keys()){const i=this.connections.get(o);!i||!i.read||r&&!r.includes(o)||i.ensureReq(e,{overwrite:n==null?void 0:n.overwrite})}}finalizeReq(e){const{subId:n,url:r}=e;if(n===void 0&&r===void 0)throw new Error;if(r){const o=this.connections.get(r);o==null||o.finalizeReq(n)}else for(const o of this.connections.values())o==null||o.finalizeReq(n)}}function an(t){return`${t.rxReqId}:${t.index??0}`}R.batch=Ji,R.chunk=es,R.compareEvents=qe,R.completeOnTimeout=Or,R.createRxBackwardReq=rs,R.createRxForwardReq=is,R.createRxNostr=ws,R.createRxOneshotReq=cs,R.createUniq=Fi,R.earlierEvent=Ho,R.evalFilters=se,R.extend=fs,R.fetchRelayInfo=Mt,R.filterBy=Zi,R.filterKind=Ki,R.filterType=Xi,R.getEventHash=Wt,R.getPublicKey=Dt,R.getSignature=Mn,R.getSignedEvent=Fn,R.isFiltered=Ft,R.laterEvent=jo,R.latest=Br,R.latestEach=Mi,R.mixin=us,R.now=M,R.sort=_r,R.sortEvents=Qi,R.timeline=Gi,R.toHex=et,R.uniq=Vi,R.verify=Yi,Object.defineProperty(R,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
