"use strict";var kr=Object.defineProperty;var qr=(t,e,n)=>e in t?kr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var P=(t,e,n)=>(qr(t,typeof e!="symbol"?e+"":e,n),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function Pr(){return Math.floor(new Date().getTime()/1e3)}function Lt(t){return"length"in t?t.map(ln):[ln(t)]}function ln(t){return{...t,since:t.since?hn(t.since):void 0,until:t.until?hn(t.until):void 0}}function hn(t){return typeof t=="number"?t:t()}const pt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ht=t=>t instanceof Uint8Array,gt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),J=(t,e)=>t<<32-e|t>>>e,Cr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Cr)throw new Error("Non little-endian hardware is not supported");const Nr=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function st(t){if(!Ht(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Nr[t[n]];return e}function Ur(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function jt(t){if(typeof t=="string"&&(t=Ur(t)),!Ht(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Lr(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!Ht(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class kn{clone(){return this._cloneInto()}}function qn(t){const e=r=>t().update(jt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Pn(t=32){if(pt&&typeof pt.getRandomValues=="function")return pt.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Le(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ae(...t){const e=(o,i)=>s=>o(i(s)),n=Array.from(t).reverse().reduce((o,i)=>o?e(o,i.encode):i.encode,void 0),r=t.reduce((o,i)=>o?e(o,i.decode):i.decode,void 0);return{encode:n,decode:r}}function ue(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Le(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function fe(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function ct(t,e="="){if(Le(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Cn(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function dn(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const o=[],i=Array.from(t);for(i.forEach(s=>{if(Le(s),s<0||s>=e)throw new Error(`Wrong integer: ${s}`)});;){let s=0,c=!0;for(let a=r;a<i.length;a++){const u=i[a],f=e*s+u;if(!Number.isSafeInteger(f)||e*s/e!==s||f-u!==e*s)throw new Error("convertRadix: carry overflow");if(s=f%n,i[a]=Math.floor(f/n),!Number.isSafeInteger(i[a])||i[a]*n+s!==f)throw new Error("convertRadix: carry overflow");if(c)i[a]?c=!1:r=a;else continue}if(o.push(s),c)break}for(let s=0;s<t.length-1&&t[s]===0;s++)o.push(0);return o.reverse()}const Nn=(t,e)=>e?Nn(e,t%e):t,Qe=(t,e)=>t+(e-Nn(t,e));function It(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Qe(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Qe(e,n)}`);let o=0,i=0;const s=2**n-1,c=[];for(const a of t){if(Le(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function Hr(t){return Le(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return dn(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(dn(e,t,2**8))}}}function me(t,e=!1){if(Le(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Qe(8,t)>32||Qe(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return It(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(It(n,t,8,e))}}}function yn(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const jr=ae(me(4),ue("0123456789ABCDEF"),fe("")),zr=ae(me(5),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ct(5),fe(""));ae(me(5),ue("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ct(5),fe(""));ae(me(5),ue("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),fe(""),Cn(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Wr=ae(me(6),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ct(6),fe("")),Dr=ae(me(6),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ct(6),fe("")),zt=t=>ae(Hr(58),ue(t),fe("")),Rt=zt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");zt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");zt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const pn=[0,2,3,5,6,7,9,10,11],Vr={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Rt.encode(r).padStart(pn[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),o=pn.indexOf(r.length),i=Rt.decode(r);for(let s=0;s<i.length-o;s++)if(i[s]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(e)}},Bt=ae(ue("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),fe("")),gn=[996825010,642813549,513874426,1027748829,705979059];function ze(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<gn.length;r++)(e>>r&1)===1&&(n^=gn[r]);return n}function wn(t,e,n=1){const r=t.length;let o=1;for(let i=0;i<r;i++){const s=t.charCodeAt(i);if(s<33||s>126)throw new Error(`Invalid prefix (${t})`);o=ze(o)^s>>5}o=ze(o);for(let i=0;i<r;i++)o=ze(o)^t.charCodeAt(i)&31;for(let i of e)o=ze(o)^i;for(let i=0;i<6;i++)o=ze(o);return o^=n,Bt.encode(It([o%2**30],30,5,!1))}function Un(t){const e=t==="bech32"?1:734539939,n=me(5),r=n.decode,o=n.encode,i=yn(r);function s(f,l,y=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const w=f.length+7+l.length;if(y!==!1&&w>y)throw new TypeError(`Length ${w} exceeds limit ${y}`);return f=f.toLowerCase(),`${f}1${Bt.encode(l)}${wn(f,l,e)}`}function c(f,l=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||l!==!1&&f.length>l)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${l})`);const y=f.toLowerCase();if(f!==y&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=y;const w=f.lastIndexOf("1");if(w===0||w===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=f.slice(0,w),h=f.slice(w+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");const p=Bt.decode(h).slice(0,-6),g=wn(d,p,e);if(!h.endsWith(g))throw new Error(`Invalid checksum in ${f}: expected "${g}"`);return{prefix:d,words:p}}const a=yn(c);function u(f){const{prefix:l,words:y}=c(f,!1);return{prefix:l,words:y,bytes:r(y)}}return{encode:s,decode:c,decodeToBytes:u,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:i,toWords:o}}const bn=Un("bech32");Un("bech32m");const Fr={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},Mr=ae(me(4),ue("0123456789abcdef"),fe(""),Cn(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),Yr={utf8:Fr,hex:Mr,base16:jr,base32:zr,base64:Wr,base64url:Dr,base58:Rt,base58xmr:Vr};`${Object.keys(Yr).join(", ")}`;function Ze(t){const{words:e}=bn.decode(t),n=new Uint8Array(bn.fromWords(e));return st(n)}function Ot(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Kr(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Ln(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Zr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ot(t.outputLen),Ot(t.blockLen)}function Gr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Qr(t,e){Ln(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Se={number:Ot,bool:Kr,bytes:Ln,hash:Zr,exists:Gr,output:Qr};function Xr(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+u,c,r)}class Jr extends kn{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=gt(this.buffer)}update(e){Se.exists(this);const{view:n,buffer:r,blockLen:o}=this;e=jt(e);const i=e.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=gt(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Se.exists(this),Se.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;Xr(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=gt(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],i)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}}const eo=(t,e,n)=>t&e^~t&n,to=(t,e,n)=>t&e^t&n^e&n,no=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ge=new Uint32Array(64);class Hn extends Jr{constructor(){super(64,32,8,!1),this.A=pe[0]|0,this.B=pe[1]|0,this.C=pe[2]|0,this.D=pe[3]|0,this.E=pe[4]|0,this.F=pe[5]|0,this.G=pe[6]|0,this.H=pe[7]|0}get(){const{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(e,n){for(let l=0;l<16;l++,n+=4)ge[l]=e.getUint32(n,!1);for(let l=16;l<64;l++){const y=ge[l-15],w=ge[l-2],d=J(y,7)^J(y,18)^y>>>3,h=J(w,17)^J(w,19)^w>>>10;ge[l]=h+ge[l-7]+d+ge[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){const y=J(c,6)^J(c,11)^J(c,25),w=f+y+eo(c,a,u)+no[l]+ge[l]|0,h=(J(r,2)^J(r,13)^J(r,22))+to(r,o,i)|0;f=u,u=a,a=c,c=s+w|0,s=i,i=o,o=r,r=w+h|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,i,s,c,a,u,f)}roundClean(){ge.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class ro extends Hn{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Xe=qn(()=>new Hn);qn(()=>new ro);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const jn=BigInt(0),at=BigInt(1),oo=BigInt(2),ut=t=>t instanceof Uint8Array,io=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function qe(t){if(!ut(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=io[t[n]];return e}function zn(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function Wt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Pe(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const o=r*2,i=t.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function D(t){return Wt(qe(t))}function Dt(t){if(!ut(t))throw new Error("Uint8Array expected");return Wt(qe(Uint8Array.from(t).reverse()))}function we(t,e){return Pe(t.toString(16).padStart(e*2,"0"))}function Wn(t,e){return we(t,e).reverse()}function so(t){return Pe(zn(t))}function z(t,e,n){let r;if(typeof e=="string")try{r=Pe(e)}catch(i){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${i}`)}else if(ut(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function Re(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!ut(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function co(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ao(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function uo(t){let e;for(e=0;t>jn;t>>=at,e+=1);return e}function fo(t,e){return t>>BigInt(e)&at}const lo=(t,e,n)=>t|(n?at:jn)<<BigInt(e),Vt=t=>(oo<<BigInt(t-1))-at,wt=t=>new Uint8Array(t),vn=t=>Uint8Array.from(t);function Dn(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=wt(t),o=wt(t),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...l)=>n(o,r,...l),a=(l=wt())=>{o=c(vn([0]),l),r=c(),l.length!==0&&(o=c(vn([1]),l),r=c())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const y=[];for(;l<e;){r=c();const w=r.slice();y.push(w),l+=r.length}return Re(...y)};return(l,y)=>{s(),a(l);let w;for(;!(w=y(u()));)a();return s(),w}}const ho={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Fe(t,e,n={}){const r=(o,i,s)=>{const c=ho[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);const a=t[o];if(!(s&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${i}`)};for(const[o,i]of Object.entries(e))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return t}const yo=Object.freeze(Object.defineProperty({__proto__:null,bitGet:fo,bitLen:uo,bitMask:Vt,bitSet:lo,bytesToHex:qe,bytesToNumberBE:D,bytesToNumberLE:Dt,concatBytes:Re,createHmacDrbg:Dn,ensureBytes:z,equalBytes:co,hexToBytes:Pe,hexToNumber:Wt,numberToBytesBE:we,numberToBytesLE:Wn,numberToHexUnpadded:zn,numberToVarBytesBE:so,utf8ToBytes:ao,validateObject:Fe},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const H=BigInt(0),k=BigInt(1),xe=BigInt(2),po=BigInt(3),_t=BigInt(4),mn=BigInt(5),En=BigInt(8);BigInt(9);BigInt(16);function W(t,e){const n=t%e;return n>=H?n:e+n}function go(t,e,n){if(n<=H||e<H)throw new Error("Expected power/modulo > 0");if(n===k)return H;let r=k;for(;e>H;)e&k&&(r=r*t%n),t=t*t%n,e>>=k;return r}function G(t,e,n){let r=t;for(;e-- >H;)r*=r,r%=n;return r}function Tt(t,e){if(t===H||e<=H)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=W(t,e),r=e,o=H,i=k;for(;n!==H;){const c=r/n,a=r%n,u=o-i*c;r=n,n=a,o=i,i=u}if(r!==k)throw new Error("invert: does not exist");return W(o,e)}function wo(t){const e=(t-k)/xe;let n,r,o;for(n=t-k,r=0;n%xe===H;n/=xe,r++);for(o=xe;o<t&&go(o,e,t)!==t-k;o++);if(r===1){const s=(t+k)/_t;return function(a,u){const f=a.pow(u,s);if(!a.eql(a.sqr(f),u))throw new Error("Cannot find square root");return f}}const i=(n+k)/xe;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,f=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,i),y=c.pow(a,n);for(;!c.eql(y,c.ONE);){if(c.eql(y,c.ZERO))return c.ZERO;let w=1;for(let h=c.sqr(y);w<u&&!c.eql(h,c.ONE);w++)h=c.sqr(h);const d=c.pow(f,k<<BigInt(u-w-1));f=c.sqr(d),l=c.mul(l,d),y=c.mul(y,f),u=w}return l}}function bo(t){if(t%_t===po){const e=(t+k)/_t;return function(r,o){const i=r.pow(o,e);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(t%En===mn){const e=(t-mn)/En;return function(r,o){const i=r.mul(o,xe),s=r.pow(i,e),c=r.mul(o,s),a=r.mul(r.mul(c,xe),s),u=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return wo(t)}const vo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function mo(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=vo.reduce((r,o)=>(r[o]="function",r),e);return Fe(t,n)}function Eo(t,e,n){if(n<H)throw new Error("Expected power > 0");if(n===H)return t.ONE;if(n===k)return e;let r=t.ONE,o=e;for(;n>H;)n&k&&(r=t.mul(r,o)),o=t.sqr(o),n>>=k;return r}function xo(t,e){const n=new Array(e.length),r=e.reduce((i,s,c)=>t.is0(s)?i:(n[c]=i,t.mul(i,s)),t.ONE),o=t.inv(r);return e.reduceRight((i,s,c)=>t.is0(s)?i:(n[c]=t.mul(i,n[c]),t.mul(i,s)),o),n}function Ft(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function So(t,e,n=!1,r={}){if(t<=H)throw new Error(`Expected Fp ORDER > 0, got ${t}`);const{nBitLength:o,nByteLength:i}=Ft(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=bo(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:i,MASK:Vt(o),ZERO:H,ONE:k,create:a=>W(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return H<=a&&a<t},is0:a=>a===H,isOdd:a=>(a&k)===k,neg:a=>W(-a,t),eql:(a,u)=>a===u,sqr:a=>W(a*a,t),add:(a,u)=>W(a+u,t),sub:(a,u)=>W(a-u,t),mul:(a,u)=>W(a*u,t),pow:(a,u)=>Eo(c,a,u),div:(a,u)=>W(a*Tt(u,t),t),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>Tt(a,t),sqrt:r.sqrt||(a=>s(c,a)),invertBatch:a=>xo(c,a),cmov:(a,u,f)=>f?u:a,toBytes:a=>n?Wn(a,i):we(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?Dt(a):D(a)}});return Object.freeze(c)}function Ao(t,e,n=!1){t=z("privateHash",t);const r=t.length,o=Ft(e).nByteLength+8;if(o<24||r<o||r>1024)throw new Error(`hashToPrivateScalar: expected ${o}-1024 bytes of input, got ${r}`);const i=n?Dt(t):D(t);return W(i,e-k)+k}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Io=BigInt(0),bt=BigInt(1);function Ro(t,e){const n=(o,i)=>{const s=i.negate();return o?s:i},r=o=>{const i=Math.ceil(e/o)+1,s=2**(o-1);return{windows:i,windowSize:s}};return{constTimeNegate:n,unsafeLadder(o,i){let s=t.ZERO,c=o;for(;i>Io;)i&bt&&(s=s.add(c)),c=c.double(),i>>=bt;return s},precomputeWindow(o,i){const{windows:s,windowSize:c}=r(i),a=[];let u=o,f=u;for(let l=0;l<s;l++){f=u,a.push(f);for(let y=1;y<c;y++)f=f.add(u),a.push(f);u=f.double()}return a},wNAF(o,i,s){const{windows:c,windowSize:a}=r(o);let u=t.ZERO,f=t.BASE;const l=BigInt(2**o-1),y=2**o,w=BigInt(o);for(let d=0;d<c;d++){const h=d*a;let p=Number(s&l);s>>=w,p>a&&(p-=y,s+=bt);const g=h,m=h+Math.abs(p)-1,I=d%2!==0,S=p<0;p===0?f=f.add(n(I,i[g])):u=u.add(n(S,i[m]))}return{p:u,f}},wNAFCached(o,i,s,c){const a=o._WINDOW_SIZE||1;let u=i.get(o);return u||(u=this.precomputeWindow(o,a),a!==1&&i.set(o,c(u))),this.wNAF(a,u,s)}}}function Vn(t){return mo(t.Fp),Fe(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ft(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Bo(t){const e=Vn(t);Fe(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Oo,hexToBytes:_o}=yo,Ae={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=Ae;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:Oo(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Ae,n=typeof t=="string"?_o(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:o,l:i}=Ae._parseInt(n.subarray(2)),{d:s,l:c}=Ae._parseInt(i);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(t){const e=u=>Number.parseInt(u[0],16)&8?"00"+u:u,n=u=>{const f=u.toString(16);return f.length&1?`0${f}`:f},r=e(n(t.s)),o=e(n(t.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},oe=BigInt(0),Q=BigInt(1);BigInt(2);const xn=BigInt(3);BigInt(4);function To(t){const e=Bo(t),{Fp:n}=e,r=e.toBytes||((d,h,p)=>{const g=h.toAffine();return Re(Uint8Array.from([4]),n.toBytes(g.x),n.toBytes(g.y))}),o=e.fromBytes||(d=>{const h=d.subarray(1),p=n.fromBytes(h.subarray(0,n.BYTES)),g=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:p,y:g}});function i(d){const{a:h,b:p}=e,g=n.sqr(d),m=n.mul(g,d);return n.add(n.add(m,n.mul(d,h)),p)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function s(d){return typeof d=="bigint"&&oe<d&&d<e.n}function c(d){if(!s(d))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(d){const{allowedPrivateKeyLengths:h,nByteLength:p,wrapPrivateKey:g,n:m}=e;if(h&&typeof d!="bigint"){if(d instanceof Uint8Array&&(d=qe(d)),typeof d!="string"||!h.includes(d.length))throw new Error("Invalid key");d=d.padStart(p*2,"0")}let I;try{I=typeof d=="bigint"?d:D(z("private key",d,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof d}`)}return g&&(I=W(I,m)),c(I),I}const u=new Map;function f(d){if(!(d instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(h,p,g){if(this.px=h,this.py=p,this.pz=g,h==null||!n.isValid(h))throw new Error("x required");if(p==null||!n.isValid(p))throw new Error("y required");if(g==null||!n.isValid(g))throw new Error("z required")}static fromAffine(h){const{x:p,y:g}=h||{};if(!h||!n.isValid(p)||!n.isValid(g))throw new Error("invalid affine point");if(h instanceof l)throw new Error("projective point not allowed");const m=I=>n.eql(I,n.ZERO);return m(p)&&m(g)?l.ZERO:new l(p,g,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){const p=n.invertBatch(h.map(g=>g.pz));return h.map((g,m)=>g.toAffine(p[m])).map(l.fromAffine)}static fromHex(h){const p=l.fromAffine(o(z("pointHex",h)));return p.assertValidity(),p}static fromPrivateKey(h){return l.BASE.multiply(a(h))}_setWindowSize(h){this._WINDOW_SIZE=h,u.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint)return;throw new Error("bad point: ZERO")}const{x:h,y:p}=this.toAffine();if(!n.isValid(h)||!n.isValid(p))throw new Error("bad point: x or y not FE");const g=n.sqr(p),m=i(h);if(!n.eql(g,m))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);const{px:p,py:g,pz:m}=this,{px:I,py:S,pz:x}=h,v=n.eql(n.mul(p,x),n.mul(I,m)),A=n.eql(n.mul(g,x),n.mul(S,m));return v&&A}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:h,b:p}=e,g=n.mul(p,xn),{px:m,py:I,pz:S}=this;let x=n.ZERO,v=n.ZERO,A=n.ZERO,R=n.mul(m,m),q=n.mul(I,I),T=n.mul(S,S),O=n.mul(m,I);return O=n.add(O,O),A=n.mul(m,S),A=n.add(A,A),x=n.mul(h,A),v=n.mul(g,T),v=n.add(x,v),x=n.sub(q,v),v=n.add(q,v),v=n.mul(x,v),x=n.mul(O,x),A=n.mul(g,A),T=n.mul(h,T),O=n.sub(R,T),O=n.mul(h,O),O=n.add(O,A),A=n.add(R,R),R=n.add(A,R),R=n.add(R,T),R=n.mul(R,O),v=n.add(v,R),T=n.mul(I,S),T=n.add(T,T),R=n.mul(T,O),x=n.sub(x,R),A=n.mul(T,q),A=n.add(A,A),A=n.add(A,A),new l(x,v,A)}add(h){f(h);const{px:p,py:g,pz:m}=this,{px:I,py:S,pz:x}=h;let v=n.ZERO,A=n.ZERO,R=n.ZERO;const q=e.a,T=n.mul(e.b,xn);let O=n.mul(p,I),j=n.mul(g,S),F=n.mul(m,x),le=n.add(p,g),b=n.add(I,S);le=n.mul(le,b),b=n.add(O,j),le=n.sub(le,b),b=n.add(p,m);let E=n.add(I,x);return b=n.mul(b,E),E=n.add(O,F),b=n.sub(b,E),E=n.add(g,m),v=n.add(S,x),E=n.mul(E,v),v=n.add(j,F),E=n.sub(E,v),R=n.mul(q,b),v=n.mul(T,F),R=n.add(v,R),v=n.sub(j,R),R=n.add(j,R),A=n.mul(v,R),j=n.add(O,O),j=n.add(j,O),F=n.mul(q,F),b=n.mul(T,b),j=n.add(j,F),F=n.sub(O,F),F=n.mul(q,F),b=n.add(b,F),O=n.mul(j,b),A=n.add(A,O),O=n.mul(E,b),v=n.mul(le,v),v=n.sub(v,O),O=n.mul(le,j),R=n.mul(E,R),R=n.add(R,O),new l(v,A,R)}subtract(h){return this.add(h.negate())}is0(){return this.equals(l.ZERO)}wNAF(h){return w.wNAFCached(this,u,h,p=>{const g=n.invertBatch(p.map(m=>m.pz));return p.map((m,I)=>m.toAffine(g[I])).map(l.fromAffine)})}multiplyUnsafe(h){const p=l.ZERO;if(h===oe)return p;if(c(h),h===Q)return this;const{endo:g}=e;if(!g)return w.unsafeLadder(this,h);let{k1neg:m,k1:I,k2neg:S,k2:x}=g.splitScalar(h),v=p,A=p,R=this;for(;I>oe||x>oe;)I&Q&&(v=v.add(R)),x&Q&&(A=A.add(R)),R=R.double(),I>>=Q,x>>=Q;return m&&(v=v.negate()),S&&(A=A.negate()),A=new l(n.mul(A.px,g.beta),A.py,A.pz),v.add(A)}multiply(h){c(h);let p=h,g,m;const{endo:I}=e;if(I){const{k1neg:S,k1:x,k2neg:v,k2:A}=I.splitScalar(p);let{p:R,f:q}=this.wNAF(x),{p:T,f:O}=this.wNAF(A);R=w.constTimeNegate(S,R),T=w.constTimeNegate(v,T),T=new l(n.mul(T.px,I.beta),T.py,T.pz),g=R.add(T),m=q.add(O)}else{const{p:S,f:x}=this.wNAF(p);g=S,m=x}return l.normalizeZ([g,m])[0]}multiplyAndAddUnsafe(h,p,g){const m=l.BASE,I=(x,v)=>v===oe||v===Q||!x.equals(m)?x.multiplyUnsafe(v):x.multiply(v),S=I(this,p).add(I(h,g));return S.is0()?void 0:S}toAffine(h){const{px:p,py:g,pz:m}=this,I=this.is0();h==null&&(h=I?n.ONE:n.inv(m));const S=n.mul(p,h),x=n.mul(g,h),v=n.mul(m,h);if(I)return{x:n.ZERO,y:n.ZERO};if(!n.eql(v,n.ONE))throw new Error("invZ was invalid");return{x:S,y:x}}isTorsionFree(){const{h,isTorsionFree:p}=e;if(h===Q)return!0;if(p)return p(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h,clearCofactor:p}=e;return h===Q?this:p?p(l,this):this.multiplyUnsafe(e.h)}toRawBytes(h=!0){return this.assertValidity(),r(l,this,h)}toHex(h=!0){return qe(this.toRawBytes(h))}}l.BASE=new l(e.Gx,e.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const y=e.nBitLength,w=Ro(l,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}function $o(t){const e=Vn(t);return Fe(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function ko(t){const e=$o(t),{Fp:n,n:r}=e,o=n.BYTES+1,i=2*n.BYTES+1;function s(b){return oe<b&&b<n.ORDER}function c(b){return W(b,r)}function a(b){return Tt(b,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:l,isWithinCurveOrder:y}=To({...e,toBytes(b,E,B){const $=E.toAffine(),_=n.toBytes($.x),L=Re;return B?L(Uint8Array.from([E.hasEvenY()?2:3]),_):L(Uint8Array.from([4]),_,n.toBytes($.y))},fromBytes(b){const E=b.length,B=b[0],$=b.subarray(1);if(E===o&&(B===2||B===3)){const _=D($);if(!s(_))throw new Error("Point is not on curve");const L=l(_);let M=n.sqrt(L);const Y=(M&Q)===Q;return(B&1)===1!==Y&&(M=n.neg(M)),{x:_,y:M}}else if(E===i&&B===4){const _=n.fromBytes($.subarray(0,n.BYTES)),L=n.fromBytes($.subarray(n.BYTES,2*n.BYTES));return{x:_,y:L}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}}),w=b=>qe(we(b,e.nByteLength));function d(b){const E=r>>Q;return b>E}function h(b){return d(b)?c(-b):b}const p=(b,E,B)=>D(b.slice(E,B));class g{constructor(E,B,$){this.r=E,this.s=B,this.recovery=$,this.assertValidity()}static fromCompact(E){const B=e.nByteLength;return E=z("compactSignature",E,B*2),new g(p(E,0,B),p(E,B,2*B))}static fromDER(E){const{r:B,s:$}=Ae.toSig(z("DER",E));return new g(B,$)}assertValidity(){if(!y(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!y(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new g(this.r,this.s,E)}recoverPublicKey(E){const{r:B,s:$,recovery:_}=this,L=A(z("msgHash",E));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const M=_===2||_===3?B+e.n:B;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Y=_&1?"03":"02",he=u.fromHex(Y+w(M)),de=a(M),Be=c(-L*de),je=c($*de),ye=u.BASE.multiplyAndAddUnsafe(he,Be,je);if(!ye)throw new Error("point at infinify");return ye.assertValidity(),ye}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Pe(this.toDERHex())}toDERHex(){return Ae.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Pe(this.toCompactHex())}toCompactHex(){return w(this.r)+w(this.s)}}const m={isValidPrivateKey(b){try{return f(b),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const b=e.randomBytes(n.BYTES+8),E=Ao(b,r);return we(E,e.nByteLength)},precompute(b=8,E=u.BASE){return E._setWindowSize(b),E.multiply(BigInt(3)),E}};function I(b,E=!0){return u.fromPrivateKey(b).toRawBytes(E)}function S(b){const E=b instanceof Uint8Array,B=typeof b=="string",$=(E||B)&&b.length;return E?$===o||$===i:B?$===2*o||$===2*i:b instanceof u}function x(b,E,B=!0){if(S(b))throw new Error("first arg must be private key");if(!S(E))throw new Error("second arg must be public key");return u.fromHex(E).multiply(f(b)).toRawBytes(B)}const v=e.bits2int||function(b){const E=D(b),B=b.length*8-e.nBitLength;return B>0?E>>BigInt(B):E},A=e.bits2int_modN||function(b){return c(v(b))},R=Vt(e.nBitLength);function q(b){if(typeof b!="bigint")throw new Error("bigint expected");if(!(oe<=b&&b<R))throw new Error(`bigint expected < 2^${e.nBitLength}`);return we(b,e.nByteLength)}function T(b,E,B=O){if(["recovered","canonical"].some(Ee=>Ee in B))throw new Error("sign() legacy options not supported");const{hash:$,randomBytes:_}=e;let{lowS:L,prehash:M,extraEntropy:Y}=B;L==null&&(L=!0),b=z("msgHash",b),M&&(b=z("prehashed msgHash",$(b)));const he=A(b),de=f(E),Be=[q(de),q(he)];if(Y!=null){const Ee=Y===!0?_(n.BYTES):Y;Be.push(z("extraEntropy",Ee,n.BYTES))}const je=Re(...Be),ye=he;function yt(Ee){const Oe=v(Ee);if(!y(Oe))return;const an=a(Oe),_e=u.BASE.multiply(Oe).toAffine(),X=c(_e.x);if(X===oe)return;const Te=c(an*c(ye+X*de));if(Te===oe)return;let un=(_e.x===X?0:2)|Number(_e.y&Q),fn=Te;return L&&d(Te)&&(fn=h(Te),un^=1),new g(X,fn,un)}return{seed:je,k2sig:yt}}const O={lowS:e.lowS,prehash:!1},j={lowS:e.lowS,prehash:!1};function F(b,E,B=O){const{seed:$,k2sig:_}=T(b,E,B),L=e;return Dn(L.hash.outputLen,L.nByteLength,L.hmac)($,_)}u.BASE._setWindowSize(8);function le(b,E,B,$=j){var _e;const _=b;if(E=z("msgHash",E),B=z("publicKey",B),"strict"in $)throw new Error("options.strict was renamed to lowS");const{lowS:L,prehash:M}=$;let Y,he;try{if(typeof _=="string"||_ instanceof Uint8Array)try{Y=g.fromDER(_)}catch(X){if(!(X instanceof Ae.Err))throw X;Y=g.fromCompact(_)}else if(typeof _=="object"&&typeof _.r=="bigint"&&typeof _.s=="bigint"){const{r:X,s:Te}=_;Y=new g(X,Te)}else throw new Error("PARSE");he=u.fromHex(B)}catch(X){if(X.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&Y.hasHighS())return!1;M&&(E=e.hash(E));const{r:de,s:Be}=Y,je=A(E),ye=a(Be),yt=c(je*ye),Ee=c(de*ye),Oe=(_e=u.BASE.multiplyAndAddUnsafe(he,yt,Ee))==null?void 0:_e.toAffine();return Oe?c(Oe.x)===de:!1}return{CURVE:e,getPublicKey:I,getSharedSecret:x,sign:F,verify:le,ProjectivePoint:u,Signature:g,utils:m}}class Fn extends kn{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Se.hash(e);const r=jt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return Se.exists(this),this.iHash.update(e),this}digestInto(e){Se.exists(this),Se.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Mn=(t,e,n)=>new Fn(t,e).update(n).digest();Mn.create=(t,e)=>new Fn(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function qo(t){return{hash:t,hmac:(e,...n)=>Mn(t,e,Lr(...n)),randomBytes:Pn}}function Po(t,e){const n=r=>ko({...t,...qo(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ft=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Je=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Yn=BigInt(1),et=BigInt(2),Sn=(t,e)=>(t+e/et)/e;function Kn(t){const e=ft,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),u=t*t*t%e,f=u*u*t%e,l=G(f,n,e)*f%e,y=G(l,n,e)*f%e,w=G(y,et,e)*u%e,d=G(w,o,e)*w%e,h=G(d,i,e)*d%e,p=G(h,c,e)*h%e,g=G(p,a,e)*p%e,m=G(g,c,e)*h%e,I=G(m,n,e)*f%e,S=G(I,s,e)*d%e,x=G(S,r,e)*u%e,v=G(x,et,e);if(!$t.eql($t.sqr(v),t))throw new Error("Cannot find square root");return v}const $t=So(ft,void 0,void 0,{sqrt:Kn}),Mt=Po({a:BigInt(0),b:BigInt(7),Fp:$t,n:Je,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Je,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Yn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=Sn(i*t,e),a=Sn(-r*t,e);let u=W(t-c*n-a*o,e),f=W(-c*r-a*i,e);const l=u>s,y=f>s;if(l&&(u=e-u),y&&(f=e-f),u>s||f>s)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:y,k2:f}}}},Xe),lt=BigInt(0),Zn=t=>typeof t=="bigint"&&lt<t&&t<ft,Co=t=>typeof t=="bigint"&&lt<t&&t<Je,An={};function tt(t,...e){let n=An[t];if(n===void 0){const r=Xe(Uint8Array.from(t,o=>o.charCodeAt(0)));n=Re(r,r),An[t]=n}return Xe(Re(n,...e))}const Yt=t=>t.toRawBytes(!0).slice(1),kt=t=>we(t,32),vt=t=>W(t,ft),We=t=>W(t,Je),Kt=Mt.ProjectivePoint,No=(t,e,n)=>Kt.BASE.multiplyAndAddUnsafe(t,e,n);function qt(t){let e=Mt.utils.normPrivateKeyToScalar(t),n=Kt.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:We(-e),bytes:Yt(n)}}function Gn(t){if(!Zn(t))throw new Error("bad x: need 0 < x < p");const e=vt(t*t),n=vt(e*t+BigInt(7));let r=Kn(n);r%et!==lt&&(r=vt(-r));const o=new Kt(t,r,Yn);return o.assertValidity(),o}function Qn(...t){return We(D(tt("BIP0340/challenge",...t)))}function Uo(t){return qt(t).bytes}function Lo(t,e,n=Pn(32)){const r=z("message",t),{bytes:o,scalar:i}=qt(e),s=z("auxRand",n,32),c=kt(i^D(tt("BIP0340/aux",s))),a=tt("BIP0340/nonce",c,o,r),u=We(D(a));if(u===lt)throw new Error("sign failed: k is zero");const{bytes:f,scalar:l}=qt(u),y=Qn(f,o,r),w=new Uint8Array(64);if(w.set(f,0),w.set(kt(We(l+y*i)),32),!Xn(w,r,o))throw new Error("sign: Invalid signature produced");return w}function Xn(t,e,n){const r=z("signature",t,64),o=z("message",e),i=z("publicKey",n,32);try{const s=Gn(D(i)),c=D(r.subarray(0,32));if(!Zn(c))return!1;const a=D(r.subarray(32,64));if(!Co(a))return!1;const u=Qn(kt(c),Yt(s),o),f=No(s,a,We(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const Zt=(()=>({getPublicKey:Uo,sign:Lo,verify:Xn,utils:{randomPrivateKey:Mt.utils.randomPrivateKey,lift_x:Gn,pointToBytes:Yt,numberToBytesBE:we,bytesToNumberBE:D,taggedHash:tt,mod:W}}))(),Ho=new TextEncoder;async function Jn(t,e){var o;const n={...t,pubkey:t.pubkey??await r(),tags:t.tags??[],created_at:t.created_at??Math.floor(new Date().getTime()/1e3)};if(zo(t))return t;if(e){const i=n.id??Gt(n),s=e.startsWith("nsec1")?Ze(e):e;return{...n,id:i,sig:n.sig??er(i,s)}}else{const i=(o=window??{})==null?void 0:o.nostr;if(!i)throw new Error("Couldn't get sig. To automatically calculate signature, a seckey argument or NIP-07 environment is required.");return i.signEvent({kind:n.kind,tags:n.tags,content:n.content,created_at:n.created_at})}async function r(){var i;if(t.pubkey)return t.pubkey.startsWith("npub1")?Ze(t.pubkey):t.pubkey;if(e)return e.startsWith("nsec1")?Pt(Ze(e)):Pt(e);{const s=await((i=window==null?void 0:window.nostr)==null?void 0:i.getPublicKey());if(!s)throw new Error("Couldn't get pubkey. To automatically calculate pubkey, a seckey argument or NIP-07 environment is required.");return s}}}function Pt(t){return st(Zt.getPublicKey(t))}function Gt(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return st(Xe(Ho.encode(e)))}function er(t,e){return st(Zt.sign(t,e))}function jo(t){try{return Zt.verify(t.sig,Gt(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function zo(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Wo(t,e){return He(t,e)<0?t:e}function Do(t,e){return He(t,e)<0?e:t}function He(t,e){return t.id===e.id?0:t.created_at<e.created_at||t.created_at===e.created_at&&t.id<e.id?-1:1}const Vo="text/plain",Fo="us-ascii",mt=(t,e)=>e.some(n=>n instanceof RegExp?n.test(t):n===t),Mo=new Set(["https:","http:","file:"]),Yo=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!Mo.has(e)}catch{return!1}},Ko=(t,{stripHash:e})=>{var l;const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let{type:r,data:o,hash:i}=n.groups;const s=r.split(";");i=e?"":i;let c=!1;s[s.length-1]==="base64"&&(s.pop(),c=!0);const a=((l=s.shift())==null?void 0:l.toLowerCase())??"",f=[...s.map(y=>{let[w,d=""]=y.split("=").map(h=>h.trim());return w==="charset"&&(d=d.toLowerCase(),d===Fo)?"":`${w}${d?`=${d}`:""}`}).filter(Boolean)];return c&&f.push("base64"),(f.length>0||a&&a!==Vo)&&f.unshift(a),`data:${f.join(";")},${c?o.trim():o}${i?`#${i}`:""}`};function Zo(t,e){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),t=t.trim(),/^data:/i.test(t))return Ko(t,e);if(Yo(t))return t;const n=t.startsWith("//");!n&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const o=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&o.protocol==="https:"&&(o.protocol="http:"),e.forceHttps&&o.protocol==="http:"&&(o.protocol="https:"),e.stripAuthentication&&(o.username="",o.password=""),e.stripHash?o.hash="":e.stripTextFragment&&(o.hash=o.hash.replace(/#?:~:text.*?$/i,"")),o.pathname){const s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let c=0,a="";for(;;){const f=s.exec(o.pathname);if(!f)break;const l=f[0],y=f.index,w=o.pathname.slice(c,y);a+=w.replace(/\/{2,}/g,"/"),a+=l,c=y+l.length}const u=o.pathname.slice(c,o.pathname.length);a+=u.replace(/\/{2,}/g,"/"),o.pathname=a}if(o.pathname)try{o.pathname=decodeURI(o.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let s=o.pathname.split("/");const c=s[s.length-1];mt(c,e.removeDirectoryIndex)&&(s=s.slice(0,-1),o.pathname=s.slice(1).join("/")+"/")}if(o.hostname&&(o.hostname=o.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(o.hostname)&&(o.hostname=o.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const s of[...o.searchParams.keys()])mt(s,e.removeQueryParameters)&&o.searchParams.delete(s);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(o.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const s of[...o.searchParams.keys()])mt(s,e.keepQueryParameters)||o.searchParams.delete(s);if(e.sortQueryParameters){o.searchParams.sort();try{o.search=decodeURIComponent(o.search)}catch{}}e.removeTrailingSlash&&(o.pathname=o.pathname.replace(/\/$/,"")),e.removeExplicitPort&&o.port&&(o.port="");const i=t;return t=o.toString(),!e.removeSingleSlash&&o.pathname==="/"&&!i.endsWith("/")&&o.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||o.pathname==="/")&&o.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),n&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}function Me(t){return e=>Object.fromEntries(Object.keys(t).map(n=>[n,(e==null?void 0:e[n])??t[n]]))}function ee(t){return Zo(t,{normalizeProtocol:!1,removeTrailingSlash:!0})}const Go=Me({sinceInclusive:!0,untilInclusive:!0});function Qt(t,e,n){return Array.isArray(e)?e.some(r=>In(t,r,n)):In(t,e,n)}function In(t,e,n){const{sinceInclusive:r,untilInclusive:o}=Go(n);if(e.ids&&e.ids.every(i=>!t.id.startsWith(i))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(i=>!t.pubkey.startsWith(i))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(o&&!(t.created_at<=e.until)||!o&&!(t.created_at<e.until)))return!1;for(const[i,s]of Object.entries(e)){if(!i.startsWith("#")||!Array.isArray(s))continue;const c=i.slice(1);if(!t.tags.find(([a,u])=>c===a&&s.includes(u)))return!1}return!0}async function Xt(t){const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}var Ct=function(t,e){return Ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},Ct(t,e)};function re(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ct(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Qo(t,e,n,r){function o(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function c(f){try{u(r.next(f))}catch(l){s(l)}}function a(f){try{u(r.throw(f))}catch(l){s(l)}}function u(f){f.done?i(f.value):o(f.value).then(c,a)}u((r=r.apply(t,e||[])).next())})}function tr(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(u){return function(f){return a([u,f])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(n=0)),n;)try{if(r=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,o=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(f){u=[6,f],o=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ce(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ne(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(c){s={error:c}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return i}function Ue(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function ke(t){return this instanceof ke?(this.v=t,this):new ke(t)}function Xo(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(y){r[y]&&(o[y]=function(w){return new Promise(function(d,h){i.push([y,w,d,h])>1||c(y,w)})})}function c(y,w){try{a(r[y](w))}catch(d){l(i[0][3],d)}}function a(y){y.value instanceof ke?Promise.resolve(y.value.v).then(u,f):l(i[0][2],y)}function u(y){c("next",y)}function f(y){c("throw",y)}function l(y,w){y(w),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Jo(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ce=="function"?Ce(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(c,a){s=t[i](s),o(c,a,s.done,s.value)})}}function o(i,s,c,a){Promise.resolve(a).then(function(u){i({value:u,done:c})},s)}}function C(t){return typeof t=="function"}function ht(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Et=ht(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,o){return o+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function nt(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Ye=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=Ce(s),a=c.next();!a.done;a=c.next()){var u=a.value;u.remove(this)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}else s.remove(this);var f=this.initialTeardown;if(C(f))try{f()}catch(h){i=h instanceof Et?h.errors:[h]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var y=Ce(l),w=y.next();!w.done;w=y.next()){var d=w.value;try{Rn(d)}catch(h){i=i??[],h instanceof Et?i=Ue(Ue([],Ne(i)),Ne(h.errors)):i.push(h)}}}catch(h){r={error:h}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}}if(i)throw new Et(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Rn(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&nt(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&nt(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),nr=Ye.EMPTY;function rr(t){return t instanceof Ye||t&&"closed"in t&&C(t.remove)&&C(t.add)&&C(t.unsubscribe)}function Rn(t){C(t)?t():t.unsubscribe()}var or={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Nt={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Nt.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,Ue([t,e],Ne(n))):setTimeout.apply(void 0,Ue([t,e],Ne(n)))},clearTimeout:function(t){var e=Nt.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function ir(t){Nt.setTimeout(function(){throw t})}function De(){}function Ge(t){t()}var Jt=function(t){re(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,rr(n)&&n.add(r)):r.destination=ri,r}return e.create=function(n,r,o){return new Ut(n,r,o)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ye),ei=Function.prototype.bind;function xt(t,e){return ei.call(t,e)}var ti=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Ke(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Ke(r)}else Ke(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Ke(n)}},t}(),Ut=function(t){re(e,t);function e(n,r,o){var i=t.call(this)||this,s;if(C(n)||!n)s={next:n??void 0,error:r??void 0,complete:o??void 0};else{var c;i&&or.useDeprecatedNextContext?(c=Object.create(n),c.unsubscribe=function(){return i.unsubscribe()},s={next:n.next&&xt(n.next,c),error:n.error&&xt(n.error,c),complete:n.complete&&xt(n.complete,c)}):s=n}return i.destination=new ti(s),i}return e}(Jt);function Ke(t){ir(t)}function ni(t){throw t}var ri={closed:!0,next:De,error:ni,complete:De},en=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ce(t){return t}function Ve(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return sr(t)}function sr(t){return t.length===0?ce:t.length===1?t[0]:function(n){return t.reduce(function(r,o){return o(r)},n)}}var V=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var o=this,i=ii(e)?e:new Ut(e,n,r);return Ge(function(){var s=o,c=s.operator,a=s.source;i.add(c?c.call(i,a):a?o._subscribe(i):o._trySubscribe(i))}),i},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Bn(n),new n(function(o,i){var s=new Ut({next:function(c){try{e(c)}catch(a){i(a),s.unsubscribe()}},error:i,complete:o});r.subscribe(s)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[en]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return sr(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Bn(e),new e(function(r,o){var i;n.subscribe(function(s){return i=s},function(s){return o(s)},function(){return r(i)})})},t.create=function(e){return new t(e)},t}();function Bn(t){var e;return(e=t??or.Promise)!==null&&e!==void 0?e:Promise}function oi(t){return t&&C(t.next)&&C(t.error)&&C(t.complete)}function ii(t){return t&&t instanceof Jt||oi(t)&&rr(t)}function si(t){return C(t==null?void 0:t.lift)}function U(t){return function(e){if(si(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function N(t,e,n,r,o){return new cr(t,e,n,r,o)}var cr=function(t){re(e,t);function e(n,r,o,i,s,c){var a=t.call(this,n)||this;return a.onFinalize=s,a.shouldUnsubscribe=c,a._next=r?function(u){try{r(u)}catch(f){n.error(f)}}:t.prototype._next,a._error=i?function(u){try{i(u)}catch(f){n.error(f)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=o?function(){try{o()}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Jt),ci=ht(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),K=function(t){re(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new On(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new ci},e.prototype.next=function(n){var r=this;Ge(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=Ce(r.currentObservers),c=s.next();!c.done;c=s.next()){var a=c.value;a.next(n)}}catch(u){o={error:u}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},e.prototype.error=function(n){var r=this;Ge(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var o=r.observers;o.length;)o.shift().error(n)}})},e.prototype.complete=function(){var n=this;Ge(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,o=this,i=o.hasError,s=o.isStopped,c=o.observers;return i||s?nr:(this.currentObservers=null,c.push(n),new Ye(function(){r.currentObservers=null,nt(c,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,o=r.hasError,i=r.thrownError,s=r.isStopped;o?n.error(i):s&&n.complete()},e.prototype.asObservable=function(){var n=new V;return n.source=this,n},e.create=function(n,r){return new On(n,r)},e}(V),On=function(t){re(e,t);function e(n,r){var o=t.call(this)||this;return o.destination=n,o.source=r,o}return e.prototype.next=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,n)},e.prototype.error=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&o!==void 0?o:nr},e}(K),ai=function(t){re(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,o=n.thrownError,i=n._value;if(r)throw o;return this._throwIfClosed(),i},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(K),tn={now:function(){return(tn.delegate||Date).now()},delegate:void 0},ui=function(t){re(e,t);function e(n,r,o){n===void 0&&(n=1/0),r===void 0&&(r=1/0),o===void 0&&(o=tn);var i=t.call(this)||this;return i._bufferSize=n,i._windowTime=r,i._timestampProvider=o,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,n),i._windowTime=Math.max(1,r),i}return e.prototype.next=function(n){var r=this,o=r.isStopped,i=r._buffer,s=r._infiniteTimeWindow,c=r._timestampProvider,a=r._windowTime;o||(i.push(n),!s&&i.push(c.now()+a)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),o=this,i=o._infiniteTimeWindow,s=o._buffer,c=s.slice(),a=0;a<c.length&&!n.closed;a+=i?1:2)n.next(c[a]);return this._checkFinalizedStatuses(n),r},e.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,o=n._timestampProvider,i=n._buffer,s=n._infiniteTimeWindow,c=(s?1:2)*r;if(r<1/0&&c<i.length&&i.splice(0,i.length-c),!s){for(var a=o.now(),u=0,f=1;f<i.length&&i[f]<=a;f+=2)u=f;u&&i.splice(0,u+1)}},e}(K),fi=function(t){re(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Ye),rt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=rt.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,Ue([t,e],Ne(n))):setInterval.apply(void 0,Ue([t,e],Ne(n)))},clearInterval:function(t){var e=rt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},li=function(t){re(e,t);function e(n,r){var o=t.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(n,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),rt.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&rt.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(s){o=!0,i=s||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,nt(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(fi),_n=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=tn.now,t}(),hi=function(t){re(e,t);function e(n,r){r===void 0&&(r=_n.now);var o=t.call(this,n,r)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},e}(_n),nn=new hi(li),di=nn,be=new V(function(t){return t.complete()});function ar(t){return t&&C(t.schedule)}function ur(t){return t[t.length-1]}function rn(t){return ar(ur(t))?t.pop():void 0}function yi(t,e){return typeof ur(t)=="number"?t.pop():e}var fr=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function lr(t){return C(t==null?void 0:t.then)}function hr(t){return C(t[en])}function dr(t){return Symbol.asyncIterator&&C(t==null?void 0:t[Symbol.asyncIterator])}function yr(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function pi(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var pr=pi();function gr(t){return C(t==null?void 0:t[pr])}function wr(t){return Xo(this,arguments,function(){var n,r,o,i;return tr(this,function(s){switch(s.label){case 0:n=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,ke(n.read())];case 3:return r=s.sent(),o=r.value,i=r.done,i?[4,ke(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,ke(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function br(t){return C(t==null?void 0:t.getReader)}function Z(t){if(t instanceof V)return t;if(t!=null){if(hr(t))return gi(t);if(fr(t))return wi(t);if(lr(t))return bi(t);if(dr(t))return vr(t);if(gr(t))return vi(t);if(br(t))return mi(t)}throw yr(t)}function gi(t){return new V(function(e){var n=t[en]();if(C(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function wi(t){return new V(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function bi(t){return new V(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,ir)})}function vi(t){return new V(function(e){var n,r;try{for(var o=Ce(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(c){n={error:c}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()})}function vr(t){return new V(function(e){Ei(t,e).catch(function(n){return e.error(n)})})}function mi(t){return vr(wr(t))}function Ei(t,e){var n,r,o,i;return Qo(this,void 0,void 0,function(){var s,c;return tr(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=Jo(t),a.label=1;case 1:return[4,n.next()];case 2:if(r=a.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=a.sent(),o={error:c},[3,11];case 6:return a.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function se(t,e,n,r,o){r===void 0&&(r=0),o===void 0&&(o=!1);var i=e.schedule(function(){n(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function mr(t,e){return e===void 0&&(e=0),U(function(n,r){n.subscribe(N(r,function(o){return se(r,t,function(){return r.next(o)},e)},function(){return se(r,t,function(){return r.complete()},e)},function(o){return se(r,t,function(){return r.error(o)},e)}))})}function Er(t,e){return e===void 0&&(e=0),U(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function xi(t,e){return Z(t).pipe(Er(e),mr(e))}function Si(t,e){return Z(t).pipe(Er(e),mr(e))}function Ai(t,e){return new V(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Ii(t,e){return new V(function(n){var r;return se(n,e,function(){r=t[pr](),se(n,e,function(){var o,i,s;try{o=r.next(),i=o.value,s=o.done}catch(c){n.error(c);return}s?n.complete():n.next(i)},0,!0)}),function(){return C(r==null?void 0:r.return)&&r.return()}})}function xr(t,e){if(!t)throw new Error("Iterable cannot be null");return new V(function(n){se(n,e,function(){var r=t[Symbol.asyncIterator]();se(n,e,function(){r.next().then(function(o){o.done?n.complete():n.next(o.value)})},0,!0)})})}function Ri(t,e){return xr(wr(t),e)}function Bi(t,e){if(t!=null){if(hr(t))return xi(t,e);if(fr(t))return Ai(t,e);if(lr(t))return Si(t,e);if(dr(t))return xr(t,e);if(gr(t))return Ii(t,e);if(br(t))return Ri(t,e)}throw yr(t)}function on(t,e){return e?Bi(t,e):Z(t)}function ie(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=rn(t);return on(t,n)}var Sr=ht(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Ar(t){return t instanceof Date&&!isNaN(t)}var Ir=ht(function(t){return function(n){n===void 0&&(n=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=n}});function Rr(t,e){var n=Ar(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,o=n.each,i=n.with,s=i===void 0?Oi:i,c=n.scheduler,a=c===void 0?e??nn:c,u=n.meta,f=u===void 0?null:u;if(r==null&&o==null)throw new TypeError("No timeout provided.");return U(function(l,y){var w,d,h=null,p=0,g=function(m){d=se(y,a,function(){try{w.unsubscribe(),Z(s({meta:f,lastValue:h,seen:p})).subscribe(y)}catch(I){y.error(I)}},m)};w=l.subscribe(N(y,function(m){d==null||d.unsubscribe(),p++,y.next(h=m),o>0&&g(o)},void 0,void 0,function(){d!=null&&d.closed||d==null||d.unsubscribe(),h=null})),!p&&g(r!=null?typeof r=="number"?r:+r-a.now():o)})}function Oi(t){throw new Ir(t)}function te(t,e){return U(function(n,r){var o=0;n.subscribe(N(r,function(i){r.next(t.call(e,i,o++))}))})}function _i(t,e,n,r,o,i,s,c){var a=[],u=0,f=0,l=!1,y=function(){l&&!a.length&&!u&&e.complete()},w=function(h){return u<r?d(h):a.push(h)},d=function(h){i&&e.next(h),u++;var p=!1;Z(n(h,f++)).subscribe(N(e,function(g){o==null||o(g),i?w(g):e.next(g)},function(){p=!0},void 0,function(){if(p)try{u--;for(var g=function(){var m=a.shift();s?se(e,s,function(){return d(m)}):d(m)};a.length&&u<r;)g();y()}catch(m){e.error(m)}}))};return t.subscribe(N(e,w,function(){l=!0,y()})),function(){c==null||c()}}function ve(t,e,n){return n===void 0&&(n=1/0),C(e)?ve(function(r,o){return te(function(i,s){return e(r,i,o,s)})(Z(t(r,o)))},n):(typeof e=="number"&&(n=e),U(function(r,o){return _i(r,o,t,n)}))}function dt(t){return t===void 0&&(t=1/0),ve(ce,t)}function Ti(){return dt(1)}function $i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ti()(on(t,rn(t)))}function ot(t,e,n){t===void 0&&(t=0),n===void 0&&(n=di);var r=-1;return e!=null&&(ar(e)?n=e:r=e),new V(function(o){var i=Ar(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){o.closed||(o.next(s++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function ki(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=rn(t),r=yi(t,1/0),o=t;return o.length?o.length===1?Z(o[0]):dt(r)(on(o,n)):be}function ne(t,e){return U(function(n,r){var o=0;n.subscribe(N(r,function(i){return t.call(e,i,o++)&&r.next(i)}))})}function sn(t){return U(function(e,n){var r=null,o=!1,i;r=e.subscribe(N(n,void 0,void 0,function(s){i=Z(t(s,sn(t)(e))),r?(r.unsubscribe(),r=null,i.subscribe(n)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(n))})}function qi(t,e,n,r,o){return function(i,s){var c=n,a=e,u=0;i.subscribe(N(s,function(f){var l=u++;a=c?t(a,f,l):(c=!0,f),r&&s.next(a)},o&&function(){c&&s.next(a),s.complete()}))}}function Pi(t){return U(function(e,n){var r=!1;e.subscribe(N(n,function(o){r=!0,n.next(o)},function(){r||n.next(t),n.complete()}))})}function it(t){return t<=0?function(){return be}:U(function(e,n){var r=0;e.subscribe(N(n,function(o){++r<=t&&(n.next(o),t<=r&&n.complete())}))})}function Ci(){return U(function(t,e){t.subscribe(N(e,De))})}function Ni(t){return te(function(){return t})}function Br(t,e){return e?function(n){return $i(e.pipe(it(1),Ci()),n.pipe(Br(t)))}:ve(function(n,r){return Z(t(n,r)).pipe(it(1),Ni(n))})}function Ui(t,e){e===void 0&&(e=nn);var n=ot(t,e);return Br(function(){return n})}function Li(t,e){return U(function(n,r){var o=new Set;n.subscribe(N(r,function(i){var s=t?t(i):i;o.has(s)||(o.add(s),r.next(i))})),e&&Z(e).subscribe(N(r,function(){return o.clear()},De))})}function Hi(t,e){return e===void 0&&(e=ce),t=t??ji,U(function(n,r){var o,i=!0;n.subscribe(N(r,function(s){var c=e(s);(i||!t(o,c))&&(i=!1,o=c,r.next(s))}))})}function ji(t,e){return t===e}function zi(t){return t===void 0&&(t=Wi),U(function(e,n){var r=!1;e.subscribe(N(n,function(o){r=!0,n.next(o)},function(){return r?n.complete():n.error(t())}))})}function Wi(){return new Sr}function Tn(t){return U(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function Di(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?ne(function(o,i){return t(o,i,r)}):ce,it(1),n?Pi(e):zi(function(){return new Sr}))}}function Vi(t,e,n,r){return U(function(o,i){var s;!e||typeof e=="function"?s=e:(n=e.duration,s=e.element,r=e.connector);var c=new Map,a=function(d){c.forEach(d),d(i)},u=function(d){return a(function(h){return h.error(d)})},f=0,l=!1,y=new cr(i,function(d){try{var h=t(d),p=c.get(h);if(!p){c.set(h,p=r?r():new K);var g=w(h,p);if(i.next(g),n){var m=N(p,function(){p.complete(),m==null||m.unsubscribe()},void 0,void 0,function(){return c.delete(h)});y.add(Z(n(g)).subscribe(m))}}p.next(s?s(d):d)}catch(I){u(I)}},function(){return a(function(d){return d.complete()})},u,function(){return c.clear()},function(){return l=!0,f===0});o.subscribe(y);function w(d,h){var p=new V(function(g){f++;var m=h.subscribe(g);return function(){m.unsubscribe(),--f===0&&l&&y.unsubscribe()}});return p.key=d,p}})}function Fi(t){t===void 0&&(t=1/0);var e;t&&typeof t=="object"?e=t:e={count:t};var n=e.count,r=n===void 0?1/0:n,o=e.delay,i=e.resetOnSuccess,s=i===void 0?!1:i;return r<=0?ce:U(function(c,a){var u=0,f,l=function(){var y=!1;f=c.subscribe(N(a,function(w){s&&(u=0),a.next(w)},void 0,function(w){if(u++<r){var d=function(){f?(f.unsubscribe(),f=null,l()):y=!0};if(o!=null){var h=typeof o=="number"?ot(o):Z(o(w,u)),p=N(a,function(){p.unsubscribe(),d()},function(){a.complete()});h.subscribe(p)}else d()}else a.error(w)})),y&&(f.unsubscribe(),f=null,l())};l()})}function Or(t,e){return U(qi(t,e,arguments.length>=2,!0))}function Mi(t){return U(function(e,n){Z(t).subscribe(N(n,function(){return n.complete()},De)),!n.closed&&e.subscribe(n)})}function Ie(t,e,n){var r=C(t)||e||n?{next:t,error:e,complete:n}:t;return r?U(function(o,i){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var c=!0;o.subscribe(N(i,function(a){var u;(u=r.next)===null||u===void 0||u.call(r,a),i.next(a)},function(){var a;c=!1,(a=r.complete)===null||a===void 0||a.call(r),i.complete()},function(a){var u;c=!1,(u=r.error)===null||u===void 0||u.call(r,a),i.error(a)},function(){var a,u;c&&((a=r.unsubscribe)===null||a===void 0||a.call(r)),(u=r.finalize)===null||u===void 0||u.call(r)}))}):ce}function Yi(t){return Li(({event:e})=>e.id,t)}function Ki(t,e){const n=new Set;return[ne(r=>{var i,s;const o=t(r);return o===null?!0:n.has(o)?((i=e==null?void 0:e.onHit)==null||i.call(e,r,n),!1):(n.add(o),(s=e==null?void 0:e.onCache)==null||s.call(e,r,n),!0)}),n]}function _r(){return Ve(Or((t,e)=>He(t.event,e.event)<0?e:t),Hi((t,e)=>t===e,({event:t})=>t.id))}function Zi(t){return Ve(Vi(t),te(Ve(_r())),dt())}function Gi(){return ne(({event:t})=>jo(t))}function Qi(t){return ne(({event:e})=>e.kind===t)}function Xi(t,e){const{not:n}=is(e),r=Lt(t);return ne(({event:o})=>{const i=Qt(o,r,e);return n?!i:i})}function Ji(t){return Or((e,n)=>{const r=[...e,n].sort((o,i)=>-1*He(o.event,i.event));return t!==void 0&&r.splice(t),r},[])}function es(t,e){return $r(t,e??((n,r)=>He(n.event,r.event)))}function ts(t){return ne(e=>e.message[0]===t)}function ns(t){return te(e=>e.reduce((n,r)=>n===null?r:r===null?n:(t??os)(n,r),null))}function rs(t,e){return ve(n=>n!==null&&t(n)?ie(...e(n)):ie(n))}function Tr(t){return Ve(Rr(t),sn(e=>{if(e instanceof Ir)return be;throw e}))}function $r(t,e){const n=[];return Ve(Ie(r=>{n.push(r),n.sort(e)}),Ui(t),te(()=>{if(n.length<=0)throw new Error("Logic Error: This is rx-nostr's internal bug.");return n.shift()}))}function os(t,e){return[...t,...e]}const is=Me({not:!1});class cn{constructor(e){P(this,"filters$",new ai(null));P(this,"_rxReqId");this._rxReqId=e??ys()}get rxReqId(){return this._rxReqId}getReqObservable(){return this.filters$.asObservable()}emit(e){const n=gs(e);n?this.filters$.next(n):this.filters$.next(null)}pipe(...e){const n=this.rxReqId,r=this.strategy;return{...this,get rxReqId(){return n},get strategy(){return r},getReqObservable:()=>this.getReqObservable().pipe(...e)}}}function ss(t){return new cs(t)}class cs extends cn{constructor(e){super(e)}get strategy(){return"backward"}}function as(t){return new us(t)}class us extends cn{constructor(e){super(e)}get strategy(){return"forward"}}function fs(t){return new ls(t)}class ls extends cn{constructor(e){super(e==null?void 0:e.subId),this.emit(e.filters)}get strategy(){return"oneshot"}}function hs(t){return t}function ds(t,e){return Object.assign(t,e())}function ys(){return`${Math.floor(Math.random()*1e6)}`}function ps(t){var o,i;const e={},n=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){e[s]=t[s];continue}if(s==="since"||s==="until"){const c=t[s];if(typeof c!="number"||(c??-1)>=0){e[s]=c;continue}}if((n(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((o=t[s])==null?void 0:o.length)??-1)>0){e[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((i=t[s])==null?void 0:i.length)??-1)>0){e[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){e[s]=t[s];continue}}return!(typeof e.since!="number"||typeof e.until!="number"||e.since<=e.until)||Object.keys(e).length<=0?null:e}function gs(t){if(!t)return null;const e=(Array.isArray(t)?t:[t]).flatMap(n=>ps(n)??[]);return e.length>0?e:null}class ws{constructor(e,n){P(this,"socket",null);P(this,"message$",new K);P(this,"error$",new K);P(this,"connectionState$",new K);P(this,"connectionState","not-started");P(this,"queuedEvents",[]);P(this,"reqs",new Map);P(this,"serverLimitations",null);P(this,"canRetry",!1);this.url=e,this.config=n,this.connectionState$.next("not-started")}get read(){return this.config.read}set read(e){this.config.read=e}get write(){return this.config.write}set write(e){this.config.write=e}get maxConcurrentReqs(){var e;return((e=this.serverLimitations)==null?void 0:e.max_subscriptions)??this.config.maxConcurrentReqsFallback??null}setConnectionState(e){this.connectionState!=="terminated"&&(this.connectionState=e,this.connectionState$.next(e))}async fetchServerLimitationsIfNeeded(){if(!(this.config.disableAutoFetchNip11Limitations||this.serverLimitations))try{const e=await Xt(this.url);this.serverLimitations=e.limitation??null}catch{}}async start(){if(!this.canRetry&&(this.connectionState==="reconnecting"||this.connectionState==="starting"||this.connectionState==="ongoing"))return Promise.resolve();this.canRetry=!1,this.connectionState==="not-started"?this.setConnectionState("starting"):this.setConnectionState("reconnecting"),await this.fetchServerLimitationsIfNeeded();let e;const n=new Promise(a=>{e=a}),r=()=>{this.setConnectionState("ongoing"),e();for(const a of this.queuedEvents)this.sendEVENT(a);this.queuedEvents=[],this.ensureReqs()},o=({data:a})=>{if(this.connectionState!=="terminated")try{this.message$.next({from:this.url,message:JSON.parse(a)})}catch(u){this.error$.next(u)}},i=()=>{e()},s=({code:a})=>{if(!(a===$e.DISPOSED_BY_RX_NOSTR||this.connectionState==="terminated")){c.removeEventListener("open",r),c.removeEventListener("message",o),c.removeEventListener("error",i),c.removeEventListener("close",s),c.close(),this.socket=null;for(const u of this.reqs.values())u.isOngoing=!1;a===$e.DESIRED_BY_RX_NOSTR?this.setConnectionState("not-started"):a===$e.DONT_RETRY?(this.setConnectionState("rejected"),this.message$.next(new St(a)),e()):(this.canRetry=!0,this.message$.next(new St(a)),e())}};if(this.connectionState==="terminated")return Promise.resolve();const c=new WebSocket(this.url);return c.addEventListener("open",r),c.addEventListener("message",o),c.addEventListener("error",i),c.addEventListener("close",s),this.socket=c,n}stop(){var e;this.finalizeAllReqs(),(e=this.socket)==null||e.close($e.DESIRED_BY_RX_NOSTR)}getConnectionState(){return this.connectionState}getMessageObservable(){const e=this.reqs;return this.message$.asObservable().pipe(ve(r=>{if(r instanceof St){if(r.code===$e.DONT_RETRY)return be;throw r}else return ie(r)}),Ie({subscribe:()=>{this.start()}}),this.config.backoff.strategy==="off"?ce:Fi({delay:(r,o)=>bs(this.config.backoff,o),count:this.config.backoff.maxCount}),Ie({error:()=>{this.setConnectionState("error")}}),n());function n(){return ne(r=>{const[o,i,s]=r.message;if(o!=="EVENT")return!0;const c=e.get(i);if(!c)return!0;const[,,...a]=c.actual;return Qt(s,a)})}}getConnectionStateObservable(){return this.connectionState$.asObservable()}getErrorObservable(){return this.error$.asObservable()}ensureReq(e,n){var i,s;const r=e[1];if(this.connectionState==="terminated"||!this.read||!(n!=null&&n.overwrite)&&((i=this.reqs.get(r))!=null&&i.isOngoing||this.reqs.has(r)&&!$n(r,this.reqs,this.maxConcurrentReqs)))return;const o=vs(e);if(this.reqs.set(r,{original:e,actual:o,isOngoing:!1}),$n(r,this.reqs,this.maxConcurrentReqs)){const c=this.reqs.get(r);c&&((s=this.socket)==null?void 0:s.readyState)===WebSocket.OPEN&&(c.isOngoing=!0,this.socket.send(JSON.stringify(o)))}}ensureReqs(){const e=Array.from(this.reqs.values()).slice(0,this.maxConcurrentReqs??void 0);for(const n of e)this.ensureReq(n.original)}finalizeReq(e){var r;if(this.connectionState==="terminated")return;const n=this.reqs.get(e);if(n&&(this.reqs.delete(e),n.isOngoing)){if(((r=this.socket)==null?void 0:r.readyState)===WebSocket.OPEN){const o=["CLOSE",e];this.socket.send(JSON.stringify(o))}this.ensureReqs()}}finalizeAllReqs(){var e;if(this.connectionState!=="terminated"){for(const n of this.reqs.keys())if(((e=this.socket)==null?void 0:e.readyState)===WebSocket.OPEN){const r=["CLOSE",n];this.socket.send(JSON.stringify(r))}this.reqs.clear()}}sendEVENT(e){var n,r;if(this.connectionState!=="terminated"&&this.write)if(((n=this.socket)==null?void 0:n.readyState)===WebSocket.OPEN)this.socket.send(JSON.stringify(e));else if(((r=this.socket)==null?void 0:r.readyState)===WebSocket.CONNECTING)this.queuedEvents.push(e);else{const o=new WebSocket(this.url);o.addEventListener("open",()=>{o.send(JSON.stringify(e))}),o.addEventListener("message",({data:i})=>{try{const s=JSON.parse(i);s[0]==="OK"&&o.close(),this.message$.next({from:this.url,message:s})}catch(s){this.message$.error(s)}}),setTimeout(()=>{(o.readyState===WebSocket.OPEN||o.readyState===WebSocket.CONNECTING)&&o.close()},10*1e3)}}dispose(){var e;this.finalizeAllReqs(),this.setConnectionState("terminated"),(e=this.socket)==null||e.close($e.DISPOSED_BY_RX_NOSTR),this.socket=null,this.reqs.clear(),this.message$.complete(),this.message$.unsubscribe(),this.connectionState$.complete(),this.connectionState$.unsubscribe(),this.error$.complete(),this.error$.unsubscribe()}}const $e={ABNORMAL_CLOSURE:1006,DONT_RETRY:4e3,DESIRED_BY_RX_NOSTR:4537,DISPOSED_BY_RX_NOSTR:4538};function bs(t,e){if(t.strategy==="exponential"){const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return ot(n)}else return t.strategy==="linear"?ot(t.interval):t.strategy==="immediately"?ie(0):be}function vs([t,e,...n]){return[t,e,...Lt(n)]}function $n(t,e,n){if(n===null)return!0;const r=Array.from(e.keys()).findIndex(o=>o===t);return r===void 0?!1:r<n}class St extends Error{constructor(e){super(`WebSocket Error: Socket was closed with code ${e}`),this.code=e}}function ms(t){return new As(t)}const Es=Me({retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},timeout:1e4,globalRelayConfig:void 0}),xs=Me({scope:void 0}),Ss=Me({scope:void 0,seckey:void 0});class As{constructor(e){P(this,"options");P(this,"connections",new Map);P(this,"ongoings",new Map);P(this,"messageIn$",new K);P(this,"error$",new K);P(this,"status$",new K);P(this,"globalEventPacketPipe",null);P(this,"disposed",!1);const n=Es(e);this.options={...n}}get messageOut$(){return this.messageIn$.pipe(ve(e=>{const n=this.globalEventPacketPipe;if(!n)return ie(e);const r=e.message;return r[0]!=="EVENT"?ie(e):ie({from:e.from,subId:r[1],event:r[2]}).pipe(n,te(({from:o,subId:i,event:s})=>({from:o,message:["EVENT",i,s]})))}))}getRelays(){return Array.from(this.connections.values()).map(({url:e,read:n,write:r})=>({url:e,read:n,write:r}))}createConnection({url:e,read:n,write:r,disableAutoFetchNip11Limitations:o}){var s,c;const i=new ws(e,{backoff:this.options.retry,read:n,write:r,disableAutoFetchNip11Limitations:o??((s=this.options.globalRelayConfig)==null?void 0:s.disableAutoFetchNip11Limitations),maxConcurrentReqsFallback:(c=this.options.globalRelayConfig)==null?void 0:c.maxConcurrentReqsFallback});return i.getConnectionStateObservable().subscribe(a=>{this.status$.next({from:e,state:a})}),i.getErrorObservable().subscribe(a=>{this.error$.next({from:e,reason:a})}),i.getMessageObservable().pipe(sn(a=>(this.error$.next({from:e,reason:a}),be))).subscribe(a=>{this.messageIn$.next(a)}),i}async switchRelays(e){const n=new Map;for(const{url:i,read:s,write:c}of o(e)){const a=this.connections.get(i);this.connections.delete(i),a?(a.read=s,a.write=c,n.set(i,a)):n.set(i,this.createConnection({url:i,read:s,write:c}))}for(const i of this.connections.values())i.dispose();const r=[];for(const i of n.values())i.read?r.push(i.start()):i.stop();if(await Promise.all(r),this.connections=n,this.disposed){for(const i of this.connections.values())i.dispose();return}for(const{req:i,scope:s}of this.ongoings.values())this.ensureReq(i,{scope:s});function o(i){return Array.isArray(i)?i.map(s=>{const c=typeof s=="string"?{url:s,read:!0,write:!0}:s;return c.url=ee(c.url),c}):Object.entries(i).map(([s,c])=>({url:ee(s),...c}))}}async addRelay(e){await this.switchRelays([...this.getRelays(),e])}async removeRelay(e){const n=ee(e),r=this.getRelays(),o=r.filter(i=>i.url!==n);r.length!==o.length&&await this.switchRelays(o)}hasRelay(e){const n=ee(e);return this.getRelays().some(r=>r.url===n)}canWriteRelay(e){const n=ee(e);return this.getRelays().some(r=>r.url===n&&r.write)}canReadRelay(e){const n=ee(e);return this.getRelays().some(r=>r.url===n&&r.read)}async fetchAllRelaysInfo(){const e=await Promise.all(Array.from(this.connections.keys()).map(async n=>[n,await Xt(n).catch(()=>null)]));return Object.fromEntries(e)}getAllRelayState(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,this.getRelayState(e.url)]))}getRelayState(e){const n=this.connections.get(ee(e));if(!n)throw new Error("RelayConfig not found");return(n==null?void 0:n.getConnectionState())??"not-started"}reconnect(e){var n;this.canReadRelay(e)&&((n=this.connections.get(ee(e)))==null||n.start())}setGlobalEventPacketPipe(e){this.globalEventPacketPipe=e}use(e,n){const{scope:r}=xs(n),o=r==null?void 0:r.map(ee),i=this.options.timeout,s=e.strategy,c=e.rxReqId,a=this.messageOut$,u=this.ongoings,f=this.getAllRelayState.bind(this),l=this.createConnectionStateObservable.bind(this),y=this.ensureReq.bind(this),w=this.finalizeReq.bind(this),d=e.getReqObservable().pipe(ne(S=>S!==null),s==="oneshot"?Di():ce,h(),s==="forward"?p():ce,Ie(S=>{y(S,{overwrite:s==="forward",scope:o})}),te(([,S])=>S));if(s==="forward"){const S=At({rxReqId:c}),x=[],v=new K;return x.push(v),v.pipe(Ie({subscribe:()=>{x.push(d.subscribe()),x.push(a.pipe(m(S),I()).subscribe(A=>{v.next(A)}))},finalize:()=>{for(const A of x)A.unsubscribe();w({subId:S})}}))}else return d.pipe(te(g),dt());function h(){const S=x=>At({rxReqId:c,index:x});switch(s){case"backward":return te((x,v)=>["REQ",S(v),...x]);case"forward":case"oneshot":return te(x=>["REQ",S(),...x])}}function p(){const S=v=>{const A=v[1];u.set(A,{req:v,scope:o})},x=v=>{u.delete(v)};return Ie({next:v=>{S(v)},finalize:()=>{x(At({rxReqId:c}))}})}function g(S){const x=new K,v=new K,A=new Set,R=ki(x,l()).subscribe(()=>{const q=f();Object.entries(q).every(([O,j])=>o&&!o.includes(O)||j==="error"||j==="terminated"||j==="ongoing"&&A.has(O))&&v.next()});return a.pipe(Mi(v),Tr(i),m(S),ne(q=>!A.has(q.from)),Ie(q=>{q.message[0]==="EOSE"&&(A.add(q.from),w({subId:S,url:q.from}),x.next())}),I(),Tn(()=>{w({subId:S}),v.unsubscribe(),x.unsubscribe(),R.unsubscribe()}))}function m(S){return ne(x=>(x.message[0]==="EVENT"||x.message[0]==="EOSE")&&x.message[1]===S)}function I(){return ve(({from:S,message:x})=>x[0]==="EVENT"?ie({from:S,subId:x[1],event:x[2]}):be)}}createAllEventObservable(){return this.messageOut$.pipe(ve(({from:e,message:n})=>n[0]==="EVENT"?ie({from:e,subId:n[1],event:n[2]}):be))}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.messageOut$}createConnectionStateObservable(){return this.status$.asObservable()}send(e,n){const{seckey:r,scope:o}=Ss(n),i=o==null?void 0:o.map(ee),s=Array.from(this.connections.values()).filter(u=>(!i||i.includes(u.url))&&u.write),c=new ui(s.length);let a=null;return Jn(e,r).then(u=>{c.closed||(a=this.createAllMessageObservable().subscribe(({from:f,message:l})=>{l[0]==="OK"&&c.next({from:f,id:u.id,ok:l[2]})}));for(const f of s)f.sendEVENT(["EVENT",u])}),c.pipe(it(s.length),Rr(30*1e3),Tn(()=>{c.complete(),c.unsubscribe(),a==null||a.unsubscribe()}))}dispose(){this.disposed=!0,this.messageIn$.complete(),this.error$.complete();for(const e of this.connections.values())e.dispose()}ensureReq(e,n){const r=n==null?void 0:n.scope;for(const o of this.connections.keys()){const i=this.connections.get(o);!i||!i.read||r&&!r.includes(o)||i.ensureReq(e,{overwrite:n==null?void 0:n.overwrite})}}finalizeReq(e){const{subId:n,url:r}=e;if(n===void 0&&r===void 0)throw new Error;if(r){const o=this.connections.get(r);o==null||o.finalizeReq(n)}else for(const o of this.connections.values())o==null||o.finalizeReq(n)}}function At(t){return`${t.rxReqId}:${t.index??0}`}exports.batch=ns;exports.chunk=rs;exports.compareEvents=He;exports.completeOnTimeout=Tr;exports.createRxBackwardReq=ss;exports.createRxForwardReq=as;exports.createRxNostr=ms;exports.createRxOneshotReq=fs;exports.createUniq=Ki;exports.earlierEvent=Wo;exports.evalFilters=Lt;exports.extend=ds;exports.fetchRelayInfo=Xt;exports.filterBy=Xi;exports.filterKind=Qi;exports.filterType=ts;exports.getEventHash=Gt;exports.getPublicKey=Pt;exports.getSignature=er;exports.getSignedEvent=Jn;exports.isFiltered=Qt;exports.laterEvent=Do;exports.latest=_r;exports.latestEach=Zi;exports.mixin=hs;exports.now=Pr;exports.sort=$r;exports.sortEvents=es;exports.timeline=Ji;exports.toHex=Ze;exports.uniq=Yi;exports.verify=Gi;
//# sourceMappingURL=index.cjs.js.map
